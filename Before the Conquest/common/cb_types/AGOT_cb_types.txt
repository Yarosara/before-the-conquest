#faction_republic_war_cb
#bid_for_independence_CW	- Independence CB that can be used by LPs during a mega war
#mini_invasion		-Used for scripted invasions (currently unused)
#rescue_prisoner		-Used in rescue prisoner plot
#bloody_vengeance
#bloody_vengeance_courtier	-Currently unused
#AGOT_invasion
#liege_intervention		-Currently unused
#great_ranging
#reclaim_ancestral_sword
#invasion_ironborn
#ironborn_raid 	-REDUNDANT
#restore_nightswatch
#dragon_conquest
#dynasty_plot_claim
#native_revolt 
#colonisation
#pirate_invasion
#anti_piracy
#invasion_ambition
#plot_replace_regent_cb
#old_ones_scourge_cb

faction_republic_war_cb = {
	name = CB_NAME_FACTION_REPUBLIC
	war_name = WAR_NAME_FACTION_REPUBLIC
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	#major_revolt = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}
	
	can_use_title = {
		holder_scope = { is_republic = no }
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REPUBLIC_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REPUBLIC_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REPUBLIC_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REPUBLIC_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			mega_war_rebel_leader_resolution_effect = yes	
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { 
			hidden_tooltip = { disband_event_forces = faction_loyalists } 
			change_variable = { which = fear_actions value = -20 }
		}
		hidden_tooltip = { #make sure attackers are re-vassalised so they can potentially become patricians
			any_attacker = {
				if = {
					limit = {
						OR = {
							AND = {
								independent = yes
								has_opinion_modifier = { who = FROM modifier = opinion_de_facto_liege } 
							}
							liege = { character = FROM }
						}	
					}
					if = {
						limit = { NOT = { character = ROOT } }
						set_character_flag = faction_republic_backer
					}	
					set_defacto_liege = FROM
				}
			}
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = FACTION_REPUBLIC_SUCCESS			
		}
		FROM = {
			war_lost_lose_authority_effect = yes
		}
		hidden_tooltip = {
			#save_event_target_as = faction_republic_title
			set_title_flag = faction_republic_title
			ROOT = { character_event = { id = faction_event_new.66 } } #the republic is formed
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } } 
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
	
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
			}
			mega_war_emperor_rebels_resolution_effect = yes
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}
bid_for_independence_CW = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_INDEPENDENCE
	sprite = 12
	truce_days = 3650
	
	is_permanent = yes
	#can_call_vassals = yes
	hostile_against_others = yes
	can_ask_to_join_war = no
	is_independence = yes
	#major_revolt = yes
	#ticking_war_score_multiplier = 0
	
	infamy_modifier = 0

	can_use = {	
		OR = {
			ROOT = { suzerain = { character = FROM } }
			AND = {
				FROM = {
					tier = EMPEROR
					higher_tier_than = ROOT
				}
				ROOT = {
					tier = KING
					independent = yes
					has_opinion_modifier = { who = FROM modifier = opinion_de_facto_liege }
					NOT = { 
						OR = {
							has_character_flag = supporting_king 
							has_character_flag = against_king 
						}	
					}
					has_character_flag = neutral
					OR = {
						has_character_flag = opportunist_independence
						ai = no
					}		
				}	
			}
		}	
	}

	is_valid = {
		OR = {
			ROOT = { suzerain = { character = FROM } }
			ROOT = {
				#
				#has_opinion_modifier = { who = FROM modifier = opinion_de_facto_liege }
				NOT = { has_character_flag = end_indep_wars }
				#has_character_flag = neutral
				#tier = KING
				independent = yes
				FROM = { tier = EMPEROR }
			}
		}	
	}
	
	on_add = {
		ROOT = {
			add_character_modifier = {
				name = "indep_war"
				duration = 100
			}
		}
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			# mega_war_rebel_leader_resolution_effect = yes	
		}
		ROOT = {		
			participation_scaled_prestige = 100
			if = {
				limit = { independent = yes }
				set_defacto_liege = ROOT
				hidden_tooltip = {	
					character_event = { id = mega_wars.50 } #Character wins indep war maintenance
					add_character_modifier = {
						name = "indep_faction_won"
						duration = 20
					}
				}
			}	
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				if = {
					limit = {
						FROM = { tier = EMPEROR }
						OR = {
							liege_before_war = { character = FROM }
							is_liege_or_above = FROM
							primary_title = {
								FROM = {
									primary_title = {
										is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
									}
								}
							}
						}
					}
					character_event = { id = mega_wars.53 days = 1 }
				}	
			}
		}
		#Tributary Independence
		ROOT = {
			suzerain = {
				if = {
					limit = { character = FROM }
					ROOT = {
						remove_tributary = PREV
					}
				}	
			}
		}

		FROM = {
			change_variable = { which = fear_actions value = -20 }
			war_lost_lose_authority_effect = yes
		}
	}

	on_fail = {
		ROOT = {
			if = { 	limit = { has_landed_title = e_north }
					k_north = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_riverlands }
					k_riverlands  = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_vale }
					k_vale = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_westerlands }
					k_westerlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_reach }
					k_reach = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_stormlands }
					k_stormlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_dorne }
					k_dorne = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_iron_isles }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail }}
			}
			hidden_tooltip = {
				if = { 	limit = { has_landed_title = e_north }
						k_north = { grant_title = PREV  }
						FROM = {
							primary_title = {
								k_north = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_riverlands }
						k_riverlands  = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_riverlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_vale }
						k_vale = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_vale = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_westerlands }
						k_westerlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_westerlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_reach }
						k_reach = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_reach = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_stormlands }
						k_stormlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_stormlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_dorne }
						k_dorne = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_dorne = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_iron_isles }
						k_iron_isles = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_iron_isles = {
									de_jure_liege = PREV
								}	
							}
						}
				}			
				if = {
					limit = {
						higher_tier_than = KING
					}
					any_war = { #end all revolts
						limit = { 
							attacker = { 
								liege_before_war = { character = PREVPREVPREV }
								NOT = { character = ROOT }
							} 
						}
						end_war = invalid
					}					
					any_demesne_title = {
						limit = { tier = EMPEROR }
						destroy_landed_title = ROOT
					}
				}
				set_defacto_liege = FROM
			}	
			clr_character_flag = opportunist_independence
			clr_character_flag = indep_war
			clr_character_flag = inherit_war
			hidden_tooltip = { character_event = { id = maintenance.24 } } #Mega war flag maintenance 
		}
		any_attacker = {
			participation_scaled_prestige = -50		
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			if = { 	limit = { has_landed_title = e_north }
					k_north = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_riverlands }
					k_riverlands  = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_vale }
					k_vale = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_westerlands }
					k_westerlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_reach }
					k_reach = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_stormlands }
					k_stormlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_dorne }
					k_dorne = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_iron_isles }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail }}
			}
			hidden_tooltip = {
				if = { 	limit = { has_landed_title = e_north }
						k_north = { grant_title = PREV  }
						FROM = {
							primary_title = {
								k_north = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_riverlands }
						k_riverlands  = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_riverlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_vale }
						k_vale = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_vale = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_westerlands }
						k_westerlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_westerlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_reach }
						k_reach = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_reach = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_stormlands }
						k_stormlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_stormlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_dorne }
						k_dorne = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_dorne = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_iron_isles }
						k_iron_isles = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_iron_isles = {
									de_jure_liege = PREV
								}	
							}
						}
				}				
				if = {
					limit = {
						higher_tier_than = KING
					}
					any_war = { #end all revolts
						limit = { 
							attacker = { 
								liege_before_war = { character = PREVPREVPREV }
								NOT = { character = ROOT }
							} 
						}
						end_war = invalid
					}
					any_demesne_title = {
						limit = { tier = EMPEROR }
						destroy_landed_title = ROOT
					}
				}
				set_defacto_liege = FROM	
			}	
			clr_character_flag = opportunist_independence
			clr_character_flag = indep_war
			clr_character_flag = inherit_war
			hidden_tooltip = { character_event = { id = maintenance.24 } } #Mega war flag maintenance 
		}
		ROOT = { 
			imprison = FROM 
			clr_character_flag = captured_in_battle			
		}
		any_attacker = {
			participation_scaled_prestige = -100			
		}
		FROM = {
			prestige = 50
		}
		hidden_tooltip = {
			mega_war_emperor_rebels_resolution_effect = yes
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}


# mini_invasion = {
	# name = CB_NAME_MINI_INVASION
	# war_name = WAR_NAME_MINI_INVASION
	# sprite = 7
	# truce_days = 365
	# hostile_against_others = no
	# can_ask_to_join_war = yes
	# is_permanent = yes
	# press_claim = yes
	# #is_claim_all = yes

	# infamy_modifier = 0
 
	# can_use = { 
		# ROOT = {
			# OR = {
				# has_character_flag = i_am_ben_plumm
				# has_character_flag = i_am_an_angry_clansman
				# AND = {
					# has_character_flag = stannis_attack_on_claw_isle
					# FROM = { has_landed_title = c_claw_isle }
				# }	
			# }
		# }
	# }

	# is_valid = {
		# ROOT = {
			# OR = {
				# has_character_flag = i_am_ben_plumm
				# has_character_flag = i_am_an_angry_clansman
				# has_character_flag = stannis_attack_on_claw_isle
			# }
		# }
	# }
	# on_success = {
		# ROOT = {
			# clr_character_flag = i_am_ben_plumm
			# clr_character_flag = i_am_an_angry_clansman	
		# }	
	# }
	# on_success_title = {
		# hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		# usurp_title_plus_barony_if_unlanded = ROOT
		# any_attacker = {
			# participation_scaled_prestige = 100
		# }
		# FROM = {
			# prestige = -100
		# }
		# if = {
			# limit = {
				# ROOT = { has_character_flag = stannis_attack_on_claw_isle }
			# }
			# ROOT = { clr_character_flag = stannis_attack_on_claw_isle }
			# FROM = {
				# transfer_scaled_wealth = {
					# to = ROOT
					# value = 24
				# }
			# }
		# }
	# }
	# on_fail = {
		# ROOT = {
			# clr_character_flag = i_am_ben_plumm
			# clr_character_flag = i_am_an_angry_clansman
			# clr_character_flag = stannis_attack_on_claw_isle
		# }	
		# ROOT = { prestige = -100 }
		# any_defender = { participation_scaled_prestige = 100 }
	# }
	# on_reverse_demand = { 
		# hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		# ROOT = {
			# prestige = -150
			# transfer_scaled_wealth = {
				# to = FROM
				# value = 4.0
			# }
			# clr_character_flag = i_am_ben_plumm
			# clr_character_flag = i_am_an_angry_clansman
			# clr_character_flag = stannis_attack_on_claw_isle
		# }
		# any_defender = { participation_scaled_prestige = 150 }
	# }

	# on_attacker_leader_death = {
		# any_defender = {
			# letter_event = {
				# id = 251
			# }
		# }
		# end_war = whitepeace
	# }

	# attacker_ai_victory_worth = {
		# factor = 150
	# }
 
	# attacker_ai_defeat_worth = {
		# factor = 100
	# }

	# defender_ai_victory_worth = {
		# factor = -1 # always accept
	# }
 
	# defender_ai_defeat_worth = {
		# factor = 100
	# }
# }

#WOLFGANG PAULI - Prisoner Rescue CB. Cannot be selected outside of plot.
rescue_prisoner = {
	name = CB_NAME_RESCUEPRISONER
	war_name = WAR_NAME_RESCUEPRISONER
	sprite = 7
	truce_days = 1825
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	infamy_modifier = 0

	can_use = {
		ROOT = { NOT = { trait = nightswatch } }
		ROOT = { 
			has_plot = plot_rescue_prisoner 
			plot_target_char = {
				has_character_flag = prisoner_rescue_target
				OR ={
					host = { character = FROM }
					liege = { character = FROM }
				}	
			}	
		}
	}
	
	is_valid = {
		ROOT = { 
			#has_plot = plot_rescue_prisoner  #can exploit by executing prisoner
			NOT = { plot_target_char = { has_character_flag = rescued_prisoner } } #Has been rescued
		}
	}
	
	on_add = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_RESCUE_PRISONER_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_RESCUE_PRISONER_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_RESCUE_PRISONER_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_RESCUE_PRISONER_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			mega_war_rebel_leader_resolution_effect = yes			
		} 
		ROOT = {
			plot_target_char = {
				if = {
					limit = { has_character_flag = prisoner_rescue_target }
					FROM = {
						transfer_scaled_wealth = {
							to = PREV
							value = 2
						}
						if = {
							limit = { is_liege_or_above = PREV }
							imprison = PREV
							clr_character_flag = captured_in_battle
						}
					}	
				}	
			}
		}
		FROM = {
			transfer_scaled_wealth = {
				to = ROOT
				value = 2
			}
			any_realm_character = {
				limit = {
					OR = {
						ROOT = {
							plot_target_char = {
								character = PREVPREV
								has_character_flag = prisoner_rescue_target
							}
						}
						AND = {
							OR = {
								AND = {
									NOT = { dynasty = 0 }
									dynasty = ROOT
								}
								is_close_relative = ROOT
								is_married = ROOT
								is_friend = ROOT
								is_consort = ROOT
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_my_abducted_spouse }
								AND = {
									OR = {
										is_liege_of = ROOT
										liege = { character = ROOT }
										ROOT = { any_spouse = { is_close_relative = PREVPREV } }
									}	
									reverse_opinion = { who = ROOT value = 0 }
								}
							}
							OR = {
								AND = {
									prisoner = yes
									host = { 
										OR = {
											character = FROM
											is_liege_or_above = FROM
										}										
									}
								}	
								AND = {
									trait = salt_wife
									liege = {
										religion_group = drowned_god_group
										culture = ironborn
									}
								}
								AND = {
									trait = slave
									liege = { has_opinion_modifier = { who = PREV modifier = opinion_my_slave } }
								}
								AND = {
									is_consort = yes
									consort = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_forced_consort } }
								}
								AND = {
									is_married = yes
									spouse = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_forced_marriage } }
								}
							}						
						}
					}
				}
				clr_character_flag = prisoner_rescue_target
				set_character_flag = rescued_prisoner
				if = {
					limit = { prisoner = yes }
					prisoner = no	
					clr_character_flag = captured_in_battle
					clr_character_flag = lost_trial_by_combat
				}
				if = {
					limit = { trait = salt_wife }
					remove_trait = salt_wife
				}
				if = {
					limit = { trait = slave }
					tooltip = { remove_trait = slave }
					hidden_tooltip = { character_event = { id = slavery.0 } }
				}				
				if = {
					limit = { 
						is_consort = yes 
						consort = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_forced_consort } }
					}
					consort = { remove_consort = PREV }
				}
				if = {
					limit = { 
						is_married = yes
						spouse = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_forced_marriage } } 
					}
					remove_spouse = yes
				}		
				if = { # Move to the saviours court...
					limit = {
						is_ruler = no
						NAND = {
							is_consort = yes
							consort = { is_ruler = yes }
						}
						NAND = {
							is_married = yes
							spouse = { is_ruler = yes }
						}
					}
					hidden_tooltip = { move_character = ROOT }
				}
				hidden_tooltip = {	
					opinion = {
						modifier = rescued_my_sorry_ass
						who = ROOT
					}
				}	
			}
			if = {
				limit = { FROM = { is_liege_or_above = ROOT } }
				imprison = ROOT
				clr_character_flag = captured_in_battle
			}
		}
		
		any_attacker = {
			participation_scaled_prestige = 100
		}
		
		any_defender = {
			participation_scaled_prestige = -50
		}
	}

	on_fail = {
		any_attacker = {
			participation_scaled_prestige = -50
		}
		any_defender = {
			participation_scaled_prestige = 50
		}
		ROOT = { 
			cancel_plot = yes
			clr_character_flag = launched_rescue_war
			clr_character_flag = plot_rescue_war_demand_issued
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		any_attacker = {
			participation_scaled_prestige = -100
		}	
		any_defender = {
			participation_scaled_prestige = 100
		}
		ROOT = { 
			if = {
				limit = { is_liege_or_above = FROM }
				imprison = FROM
				clr_character_flag = captured_in_battle
			}
			cancel_plot = yes
			clr_character_flag = launched_rescue_war
			clr_character_flag = plot_rescue_war_demand_issued
			transfer_scaled_wealth = {
				to = FROM
				value = 4
			}
		}
		hidden_tooltip = {
			mega_war_emperor_rebels_resolution_effect = yes
		}
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 75
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 75
	}
}

#Vengeance wars, i.e. vendettas, by Wolfgang Pauli
bloody_vengeance = {
	name = CB_NAME_BLOODY_VENGEANCE #Bloody Vengeance
	war_name = WAR_NAME_BLOODY_VENGEANCE #$ORDER$$FIRST$ Vendetta against $SECOND$
	sprite = 7
	truce_days = 1825
	
	can_ask_to_join_war = yes
	is_permanent = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	
	allow_distant = yes # AI parameter

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
		custom_tooltip = {
			text = TOOLTIPJOGOSWARPROHIBITION
			hidden_tooltip = {
				NAND = { #jogos nhai do not make war on eachother
					ROOT = { religion = jogos_pagan }
					FROM = { religion = jogos_pagan }
				}
			}
		}
	}
	
	can_use = { #Can be used for Dynasty feuds, vengeance or looting retribution
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
			NOT = { trait = kingsguard }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}
		OR = {
			ROOT = {
				OR = {
					has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
					has_opinion_modifier = { who = FROM modifier = opinion_blood_feud }
				}	
			}
			FROM = {
				#is_allowed_to_loot = yes
				NOT = { trait = pirate } #seperate CB
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_looted }
			}
		}	
		FROM = { prisoner = no }
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	is_valid = {
		OR = {
			ROOT = {
				OR = {
					has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
					has_opinion_modifier = { who = FROM modifier = opinion_blood_feud }
					has_opinion_modifier = { who = FROM modifier = looting_vengeance_war }
				}	
			}
			FROM = {
				is_allowed_to_loot = yes
				NOT = { trait = pirate } #seperate CB
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_looted }
					any_realm_lord = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_looted } }
				}	
			}
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}			
	}
	
	on_add = {
		hidden_tooltip = {
			if = {
				limit = { 
					#FROM = { is_allowed_to_loot = yes }
					ROOT = {
						OR = {
							has_opinion_modifier = { who = FROM modifier = opinion_looted }
							any_realm_lord = { has_opinion_modifier = { who = FROM modifier = opinion_looted } }
						}	
					}	
				}
				ROOT = { 
					opinion = { who = FROM modifier = looting_vengeance_war years = 20 }
				}
			}
		}	
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_VENGEANCE_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_VENGEANCE_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_VENGEANCE_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_VENGEANCE_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			mega_war_rebel_leader_resolution_effect = yes	
		} 
		FROM = { 
			imprison = ROOT
			change_variable = { which = fear_actions value = -20 }
			clr_character_flag = captured_in_battle
			if = { #If blood feud take family prisoner
				limit = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud } }
				custom_tooltip = { text = VENGEANCEIMPRISONDYNASTY }
				hidden_tooltip = {			
					any_courtier = {
						limit = { dynasty = FROM }
						imprison = ROOT
						clr_character_flag = captured_in_battle
					}
				}	
			}	
			if = {
				limit = { #If looting vengeance take much gold
					OR = {
						ROOT = { has_opinion_modifier = { who = FROM modifier = looting_vengeance_war }	}
						AND = {
							#FROM = { is_allowed_to_loot = yes }
							ROOT = {
								OR = {
									has_opinion_modifier = { who = FROM modifier = opinion_looted }
									any_realm_lord = { has_opinion_modifier = { who = FROM modifier = opinion_looted } }
								}	
							}
						}	
					}	
				}
				custom_tooltip = { text = TOOLTIPlootvengeancereturnloot }
				hidden_tooltip = { 
					character_event = { id = raid_events.99 }
					#add cooldown on asking for redress again
					opinion = { who = ROOT modifier = opinion_demanded_raiding_redress months = 60 }
					current_heir = { opinion = { who = ROOT modifier = opinion_demanded_raiding_redress months = 60 } }
					#forbid further raids
					opinion = { who = ROOT modifier = forbidden_raid_target months = 120 } 
					current_heir = { opinion = { who = ROOT modifier = forbidden_raid_target months = 120 } }
				}
				transfer_scaled_wealth = {
					to = ROOT
					value = 6
				}
			}
			if = {
				limit = { 
					NOT = {
						OR = {
							ROOT = { has_opinion_modifier = { who = FROM modifier = looting_vengeance_war }	}
							AND = {
								#FROM = { is_allowed_to_loot = yes }
								ROOT = {
									OR = {
										has_opinion_modifier = { who = FROM modifier = opinion_looted }
										any_realm_lord = { has_opinion_modifier = { who = FROM modifier = opinion_looted } }
									}	
								}
							}	
						}	
					}	
				}
				transfer_scaled_wealth = {
					to = ROOT
					value = 4
				}
			}	
		}
		ROOT = { #Take any claims
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_claim = PREV }
				}
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
				if = {
					limit = {
						higher_tier_than = BARON
						NOT = { culture = ROOT }
					}
					hidden_tooltip = { conquest_culture = ROOT }
				}
				if = {
					limit = { title = e_iron_throne } #Lose crownlands
					hidden_tooltip = { holder_scope = { character_event = { id = maintenance.37 } } }
				}
			}
			FROM = { #dejure claims
				any_demesne_title = {
					limit = { dejure_liege_title = { holder = ROOT } }
					if = {
						limit = { holder_scope = { NOT = { lower_tier_than = ROOT } } }
						usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
					}
					if = {
						limit = { holder_scope = { lower_tier_than = ROOT } }
						holder_scope = { set_defacto_liege = ROOT }
					}
				}
				any_realm_lord = {
					any_demesne_title = {
						limit = { dejure_liege_title = { holder = ROOT } }
						if = {
							limit = { holder_scope = { NOT = { lower_tier_than = ROOT } } }
							usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
						}
						if = {
							limit = { holder_scope = { lower_tier_than = ROOT } }
							holder_scope = { set_defacto_liege = ROOT }
						}
					}
				}
				if = {
					limit = { is_liege_or_above = ROOT }
					hidden_tooltip = { character_event = { id = maintenance.25 } }#Subjugation flag maintenance
				}	
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		hidden_tooltip = {
			ROOT = { 
				remove_opinion = { who = FROM modifier = looting_vengeance_war } 
			}
		}
	}
	
	on_fail = {
		ROOT = {
			prestige = -50
			transfer_scaled_wealth = {
				to = FROM
				value = 1.0
			}
			hidden_tooltip = { 
				remove_opinion = { who = FROM modifier = looting_vengeance_war } 
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}
	
	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = { 
			imprison = FROM
			clr_character_flag = captured_in_battle			
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}
				remove_claim = ROOT
			}
			prestige = -100
			hidden_tooltip = { 
				remove_opinion = { who = FROM modifier = looting_vengeance_war } 
			}
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		hidden_tooltip = {
			mega_war_emperor_rebels_resolution_effect = yes
		}
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1.5
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

#Bloody vengeance, courtier target
# bloody_vengeance_courtier = {
	# name = CB_NAME_BLOODY_VENGEANCE_COURTIER #Bloody Vengeance
	# war_name = WAR_NAME_BLOODY_VENGEANCE #$ORDER$$FIRST$ Vendetta against $SECOND$
	# sprite = 7
	# truce_days = 1825
	# can_ask_to_join_war = yes

	# infamy_modifier = 0
	
	# can_use = {
		# FROM = {
			# any_courtier = {
				# #ROOT = {
					# reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
				# #}
			# }
		# }
	# }
	
	# on_add = {
		# FROM = {
			# any_courtier = {
				# limit = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance } }
				# set_character_flag = vendetta_target
			# }
		# }	
	# }
	
	# on_success = {
		# hidden_tooltip = { 
			# ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			# mega_war_rebel_leader_resolution_effect = yes				
		# } 
		# FROM = { #ROOT kills FROM's target courtiers
			# any_courtier = {
				# if = {
					# limit = { has_character_flag = vendetta_target }
					# death = {
						# death_reason = death_execution
						# killer = ROOT
					# }
					# clr_character_flag = vendetta_target
				# }
			# }
		# }
		
		# any_attacker = { participation_scaled_prestige = 100 }
		# any_defender = { participation_scaled_prestige = -50 }
	# }
	
	# on_fail = {
		# any_attacker = { participation_scaled_prestige = -50 }
		# FROM = { any_courtier = { clr_character_flag = vendetta_target } }
	# }
	
	# on_reverse_demand = {
		# hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		# ROOT = { imprison = FROM } #ROOT becomes prisoner of FROM
		# any_attacker = { participation_scaled_prestige = -100 }
		# any_defender = { participation_scaled_prestige = 50 }
		# FROM = { any_courtier = { clr_character_flag = vendetta_target } }
		# hidden_tooltip = {
			# mega_war_emperor_rebels_resolution_effect = yes
		# }
	# }
	
	# on_attacker_leader_death = {
		# if = {
			# limit = {
				# ROOT = {
					# NOT = {
						# any_realm_character = {
							# OR = {
								# has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
								# has_opinion_modifier = { who = FROM modifier = opinion_burned_closed_relative }
							# }	
						# }
					# }	
				# }
			# }
			# end_war = invalid
		# }
	# }
	
	# # ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	# ai_will_do = { 
		# factor = 1
		# #Dragon intimidation
		# modifier = {
			# factor = 0.1
			# ROOT = { NOT = { trait = dragon_rider } }
			# FROM = { 
				# trait = dragon_rider 
				# NOT = { trait = incapable }
			# }
		# }	
	# }
	
	# attacker_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# attacker_ai_defeat_worth = {
		# factor = 100
	# }

	# defender_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# defender_ai_defeat_worth = {
		# factor = 100
	# }
# }

# Culture Invasion
AGOT_invasion = { #Takes all occupied titles and subjugates target 
	name = CB_NAME_INVASION
	war_name = WAR_NAME_AGOT_INVASION
	sprite = 8
	truce_days = 365
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		ROOT = {
			is_adult = yes
			has_regent = no
		}
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
		OR = {
			FROM = { NOT = { primary_title = { title = d_nightswatch } } }
			ROOT = { higher_tier_than = COUNT }
		}
	}
	
	can_use_title = {
		ROOT = { 
			OR = {	
				AND = {
					government = wildling_feudal_government
					top_liege = { government = wildling_feudal_government }
				}
				# AND = {
					# culture = shadowlander
					# top_liege = { culture = shadowlander }
				# }
				# AND = {
					# trait = wildling
					# top_liege = { trait = wildling }
				# }
				AND = { #Special Night's King claim on beyond the wall
					has_landed_title = k_nightswatch
					PREV = { kingdom = { title = k_beyond_wall } }
				}
			}
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		OR = {
			FROM = { has_landed_title = PREV }
			holder_scope = { is_liege_or_above = FROM }
		}	
		OR = {
			higher_tier_than = DUKE
			AND = {
				tier = DUKE
				holder_scope = { tier = DUKE }
			}
			AND = {
				tier = COUNT
				holder_scope = { tier = COUNT }
			}
		}
		controls_religion = no	
		NOT = { title = d_nightswatch }	
		NOT = { title = d_kingsguard }
		# Can only invade neighbors
		ROOT = {
			OR = {
				has_character_flag = wildling_horde
				any_realm_province = {
					has_owner = yes
					owner = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
					any_neighbor_province = {
						has_owner = yes
						owner = {
							OR = {
								character = FROM
								is_liege_or_above = FROM
							}
						}
					}
				}
			}	
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	is_valid_title = {		
		ROOT = {
			OR = {				
				AND = {
					culture = shadowlander
					top_liege = { culture = shadowlander }
				}
				AND = {
					trait = wildling
					top_liege = { trait = wildling }
				}
				AND = { #Special Night's King claim on beyond the wall
					has_landed_title = k_nightswatch
					PREV = { kingdom = { title = k_beyond_wall } }
				}
			}
		}
		OR = {
			FROM = { has_landed_title = PREV }
			holder_scope = { is_liege_or_above = FROM }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		hidden_tooltip = { FROM = { character_event = { id = diplomatic.3099 } } } #call for aid?
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success_title = {
		hidden_tooltip = { 
			ROOT = { 
				add_character_modifier = { name = victory_timer duration = 3 }
				if = {
					limit = { has_ambition = obj_expand_realm }
					set_character_flag = obj_expand_realm_success
				}
			}
		}
		if = {
			limit = { FROM = { is_nomadic = yes } } #nomads pay tribute
			FROM = {
				custom_tooltip = {
					text = "REMOVE_PREVIOUS_SUZERAIN"
					hidden_tooltip = {
						any_suzerain = {
							FROM = {
								remove_tributary = PREV
							}
						}
					}
				}
			}
			ROOT = { make_tributary = { who = FROM percentage = 0.4 } }
			FROM = { #lose any non-nomad vassals
				any_vassal = {
					limit = {
						NOT = { is_nomadic = yes }
						NOT = { tier = BARON }
						lower_tier_than = ROOT
					}
					set_defacto_liege = ROOT
					hidden_tooltip = { character_event = { id = maintenance.25 } }#Subjugation flag maintenance
				}
			}
		}	
		if = {
			limit = { FROM = { NOT = { is_nomadic = yes } } }
			ROOT = {
				hidden_tooltip = {
					occupy_minors_of_occupied_settlements = FROM
					gain_all_occupied_titles = FROM
				}
				PREV = {
					custom_tooltip = {
						text = invasion_succ_tip
						hidden_tooltip = {
							usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
							FROM = { 
								if = {
									limit = { NOT = { trait = nightswatch } }
									set_defacto_liege = ROOT 
								}	
							}
							if = {
								limit = {
									FROM = { is_liege_or_above = ROOT }
								}
								FROM = { imprison = ROOT clr_character_flag = captured_in_battle }
							}
							any_de_jure_vassal_title = {
								if = {
									limit = { 
										is_primary_holder_title = yes
										holder_scope = { 
											lower_tier_than = ROOT
											liege = { character = FROM }
										}
									}
									holder_scope = { set_defacto_liege = ROOT }
								}
								if = {
									limit = { 
										OR = {
											is_primary_holder_title = no
											holder_scope = { NOT = { lower_tier_than = ROOT } }
										}	
										holder_scope = { liege = { character = FROM } }
									}
									usurp_title = { target = ROOT type = invasion }
								}
								if = {
									limit = { 
										OR = {
											holder_scope = { trait = nightswatch }
											location = { region = world_the_wall } 
										}	
									}
									usurp_title = { target = ROOT type = invasion }
								}
							}
							FROM = {
								if = {
									limit = { is_liege_or_above = ROOT }
									character_event = { id = maintenance.25 } #Subjugation flag maintenance
								}	
								if = {
									limit = { 
										trait = nightswatch
										NOT = { demesne_size = 1 }
									}
									imprison = ROOT
									clr_character_flag = captured_in_battle
								}
							}
						}
					}
				}			
				hidden_tooltip = {
					character_event = { id = maintenance.24 } #Mega war flag maintenance
				}
			}
		}	
		any_attacker = {
			participation_scaled_prestige = 100
		}
		FROM = {
			prestige = -100
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			participation_scaled_prestige = 50
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = { character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } }#Take back dejure vassals (AGOT)
		any_defender = {
			participation_scaled_prestige = 100
			# if = {
				# limit = { has_character_flag = joins_the_wall }
				
			# }
		}
	}

	attacker_ai_victory_worth = {
		factor = 150
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 2
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
		modifier = { #Dont attack tributaries with strong suzerain
			factor = 0
			FROM = { 
				is_tributary = yes
				suzerain = {
					OR = {
						relative_power = { who = ROOT power = 1.5 }
						reverse_opinion = { who = ROOT value = 50 }
					}
				}
			}
		}		
	}
}

# liege_intervention = {
	# name = CB_NAME_LIEGE_INTERVENTION
	# war_name = WAR_NAME_LIEGE_INTERVENTION
	# sprite = 1
	# truce_days = 3650
	
	# hostile_against_others = no
	
	# attacker_can_call_allies = no
	# can_attack_vassals = yes
	
	# can_use = { always = no } # Can only be activated by event. I hope.

	# infamy_modifier = 0
	
	# is_valid = {
		# ROOT = { liege = { character = PREVPREV } }
		# FROM = { liege = { character = PREVPREV } }
		
		# # Only valid while ROOT and FROM are on opposite sides of some other war
		# ROOT = {
			# any_war = {
				# NOT = { using_cb = liege_intervention }
				# OR = {
					# AND = {
						# attacker = { character = ROOT }
						# defender = { character = FROM }
					# }
					# AND = {
						# attacker = { character = FROM }
						# defender = { character = ROOT }
					# }
				# }
			# }
		# }
		
		# # Abort if ROOT declares war on liege
		# NOT = { war_with = ROOT }
	# }
	
	# on_success = {
		# hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		# prestige = 200
		# FROM = { imprison = ROOT }
	# }
	
	# on_fail = {
		# prestige = -100
		# FROM = { prestige = 100 }
	# }
	
	# on_reverse_demand = {
		# hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		# prestige = -200
		# FROM = { prestige = 200 }
		# ROOT = { imprison = FROM }
		
		# war_lost_lose_authority_effect = yes
	# }
	
	# attacker_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# attacker_ai_defeat_worth = {
		# factor = 100
	# }

	# defender_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# defender_ai_defeat_worth = {
		# factor = 100
	# }
# }

great_ranging = {
	name = "CB_NAME_GREAT_RANGING"
	war_name = "WAR_NAME_GREAT_RANGING"
	sprite = 1
	truce_days = 0
	hostile_against_others = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	
	is_permanent = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			primary_title = { title = d_nightswatch }
			trait = nightswatch			
		}
		FROM = {
			any_demesne_title = {
				higher_tier_than = COUNT
				controls_religion = no
				is_landless_type_title = no
			}	
			trait = wildling
			independent = yes
		}
	}
	
	is_valid = {
		ROOT = {
			primary_title = { title = d_nightswatch }
			trait = nightswatch	
		}
		FROM = { trait = wildling }
	}
	
	on_add = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_GREAT_RANGING_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_GREAT_RANGING_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_GREAT_RANGING_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_GREAT_RANGING_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = { 
			any_demesne_title = { 
				limit = { 
					higher_tier_than = COUNT 
					controls_religion = no
					is_landless_type_title = no
				}
				destroy_landed_title = yes 
			} 
			if = { #Deserters lose all lands and are sent back to watch to answer for crimes
				limit = { trait = deserter }
				tooltip = {
					any_demesne_title = { 
						limit = { 
							lower_tier_than = DUKE
							controls_religion = no
							is_landless_type_title = no
						}
						destroy_landed_title = yes
					}
				}	
				hidden_tooltip = {
					create_random_soldier = {
						random_traits = yes
						dynasty = culture
						religion = beyond_wall_old_gods
						culture = wildling
						female = no
					}
					new_character = {
						change_martial = 2
						change_diplomacy = 2
						random_list = {
							10 = { add_trait = master_warrior }
							30 = { add_trait = skilled_warrior }
							40 = { add_trait = trained_warrior }
							20 = { add_trait = poor_warrior }
						}
						move_character = PREV
						liege = { abdicate_to = PREV }
					}
					move_character = ROOT
					remove_trait = deserter
					remove_trait = disinherited
					add_trait = nightswatch
					reverse_opinion = { who = ROOT modifier = opinion_traitor } 
				}
			}
			imprison = ROOT 
			clr_character_flag = captured_in_battle
		}		
		ROOT = {
			prestige = 150
		}
		FROM = {
			prestige = -200
			transfer_scaled_wealth = {
				to = ROOT
				value = 2.0
			}
		}
	}
	
	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = { participation_scaled_prestige = 100 }
	}
	
	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		any_defender = { participation_scaled_prestige = 200 }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = ROOT
				value = 4.0
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 2
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}
reclaim_ancestral_sword = {
	# name = CB_NAME_DEPOSE_LIEGE
	# war_name = WAR_NAME_DEPOSE_LIEGE
	name = CB_NAME_RECLAIM_SWORD
	war_name = WAR_NAME_RECLAIM_SWORD
	sprite = 12
	truce_days = 3650
	
	is_permanent = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	ticking_war_score_multiplier = 5.0

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
		custom_tooltip = {
			text = TOOLTIPJOGOSWARPROHIBITION
			hidden_tooltip = {
				NAND = { #jogos nhai do not make war on eachother
					ROOT = { religion = jogos_pagan }
					FROM = { religion = jogos_pagan }
				}
			}
		}
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
			NOT = { trait = kingsguard }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
		OR = {
			ice = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_ice }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 59 } #Stark 
					}
				}
			}
			longclaw_snow = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_longclaw }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 102 }  
					}
				}
			}
			longclaw = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_longclaw }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 102 } 
					}
				}
			}
			blackfyre = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_blackfyre  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 496
								dynasty = 57
							}
						} 
					}
				}
			}
			darksister = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_darksister  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 496 } 
					}
				}
			}
			brightroar = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_brightroar  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 190 } 
					}
				}
			}
			widowswail = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_widowswail }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 190
								dynasty = 59
							}
						} 
					}
				}
			}
			oathkeeper = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_oathkeeper }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 190
								dynasty = 59
							}
						} 
					}
				}
			}
			heartsbane = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_heartsbane  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 296 } 
					}
				}
			}
			nightfall = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_nightfall  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 122 } 
					}
				}
			}
			ladyforlorn = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_ladyforlorn  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 176 } 
					}
				}
			}	
			redrain = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_redrain }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 121
								dynasty = 197
							}
						} 
					}
				}
			}
			crabspincer = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_crabspincer  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 50 } 
					}
				}
			}	
			vigilance = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_vigilance }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 285 } 
					}
				}
			}
			orphan_maker = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_orphan_maker }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 247 } 
					}
				}
			}
			palemoon = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_palemoon }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 69157 } 
					}
				}
			}
			truth = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_truth }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 55999 } 
					}
				}
			}
			lamentation = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_lamentation }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 187 } 
					}
				}
			}
			poison = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_poison }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 982375 } 
					}
				}
			}
			valyrian_steel = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_sword }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			strangers_mercy = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_strangers_mercy }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			anger = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_anger }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			black_death = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_black_death }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			compassion = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_compassion }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			blackpaw = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_blackpaw }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}			
			del_pino = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_del_pino }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			el_swordo = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_el_swordo }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			gold_sword = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_gold_sword }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			happyness = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_happyness }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			hubris = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_hubris }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			justice = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_justice }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			kingmaker = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_kingmaker }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			passion = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_passion }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			rage = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_rage }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}				
			sightblinder = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_sightblinder }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			the_monarchist = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_the_monarchist }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			the_usurper = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_the_usurper }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			worldeater = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_worldeater }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			worlds_envy = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_worlds_envy }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			valyrian_armour = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_valyrian_armour }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}				
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	is_valid = {
		OR = {
			ice = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_ice }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 59 } #Stark 
					}
				}
			}
			longclaw_snow = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_longclaw }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 102 }  
					}
				}
			}
			longclaw = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_longclaw }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 102 } 
					}
				}
			}
			blackfyre = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_blackfyre  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 496
								dynasty = 57
							}
						} 
					}
				}
			}
			darksister = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_darksister  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 496 } 
					}
				}
			}
			brightroar = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_brightroar  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 190 } 
					}
				}
			}
			widowswail = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_widowswail }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 190
								dynasty = 59
							}
						} 
					}
				}
			}
			oathkeeper = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_oathkeeper }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 190
								dynasty = 59
							}
						} 
					}
				}
			}
			heartsbane = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_heartsbane  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 296 } 
					}
				}
			}
			nightfall = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_nightfall  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 122 } 
					}
				}
			}
			ladyforlorn = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_ladyforlorn  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 176 } 
					}
				}
			}	
			redrain = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_redrain }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 121
								dynasty = 197
							}
						} 
					}
				}
			}
			crabspincer = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_crabspincer  }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 50 } 
					}
				}
			}	
			vigilance = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_vigilance }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 285 } 
					}
				}
			}
			orphan_maker = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_orphan_maker }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 247 } 
					}
				}
			}
			valyrian_steel = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_sword }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			strangers_mercy = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_strangers_mercy }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			palemoon = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_palemoon }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 69157 } 
					}
				}
			}
			truth = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_truth }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 55999 } 
					}
				}
			}
			lamentation = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_lamentation }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 187 } 
					}
				}
			}
			poison = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_poison }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 982375 } 
					}
				}
			}
			anger = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_anger }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			black_death = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_black_death }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			compassion = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_compassion }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			blackpaw = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_blackpaw }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}			
			del_pino = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_del_pino }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			el_swordo = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_el_swordo }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			gold_sword = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_gold_sword }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			happyness = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_happyness }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			hubris = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_hubris }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			justice = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_justice }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			kingmaker = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_kingmaker }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			passion = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_passion }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			rage = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_rage }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}				
			sightblinder = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_sightblinder }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			the_monarchist = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_the_monarchist }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			the_usurper = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_the_usurper }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			worldeater = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_worldeater }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}
			worlds_envy = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_worlds_envy }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}	
			valyrian_armour = {
				is_alive = yes
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_valyrian_armour }
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				NOT = { is_liege_or_above = ROOT }		
			}			
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add = {
		#letter_event = { id = valyrian_steel.100 } #Surrender Demand
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_SWORD_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_SWORD_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_SWORD_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_SWORD_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		valyrian_steel = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_sword }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMVALYRIANSTEELWAR }
			hidden_tooltip = { remove_trait = valyrian_steel opinion = { who = ROOT modifier = opinion_stole_sword years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = valyrian_steel add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}
		ice = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_ice }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 59 } #Stark 
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMICEWAR }
			hidden_tooltip = { remove_trait = ice opinion = { who = ROOT modifier = opinion_stole_ice years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = ice add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}
		widowswail = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_widowswail }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 59 #Stark
								dynasty = 190
							}	
						}
					}
				}
			}
			if = {
				limit = { 
					NOT = { ice = { is_alive = yes } } 
					ROOT = { dynasty = 59 } #Stark
				}
				custom_tooltip = { text = TOOLTIPREREFORGEWIDOWSWAILWAR }
				hidden_tooltip = { remove_trait = widowswail opinion = { who = ROOT modifier = opinion_stole_ice years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
				if = {
					limit = { NOT = { character = FROM } }
					hidden_tooltip = { prestige = -100 }
				}
				hidden_tooltip = { ROOT = { add_trait = ice set_character_flag = ice_reforged add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
			}
			if = {
				limit = { ROOT = { NOT = { has_character_flag = ice_reforged } }	}
				if = {
					limit = { 
						ROOT = {
							trait = ice
							dynasty = 59
						}	
					} 
					custom_tooltip = { text = TOOLTIPREREFORGEWIDOWSWAILWAR }
					hidden_tooltip = { remove_trait = widowswail opinion = { who = ROOT modifier = opinion_stole_ice years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
					if = {
						limit = { NOT = { character = FROM } }
						hidden_tooltip = { prestige = -100 }
					}
				}
				if = {
					limit = { 
						ROOT = {
							OR = {
								NOT = { trait = ice }
								NOT = { dynasty = 59 }
							}	
						}	
					} 
					custom_tooltip = { text = TOOLTIPRECLAIMWIDOWSWAILWAR }
					hidden_tooltip = { remove_trait = widowswail opinion = { who = ROOT modifier = opinion_stole_widowswail years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
					if = {
						limit = { NOT = { character = FROM } }
						hidden_tooltip = { prestige = -100 }
					}
					hidden_tooltip = { ROOT = { add_trait = widowswail add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
				}
			}	
		}
		ROOT = { clr_character_flag = ice_reforged }	
		oathkeeper = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_oathkeeper }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 59 #Stark
								dynasty = 190
							}	
						}
					}
				}
			}
			if = {
				limit = { 
					NOT = { ice = { is_alive = yes } } 
					ROOT = { dynasty = 59 } #Stark
				}
				custom_tooltip = { text = TOOLTIPREREFORGEOATHKEEPERWAR }			
				hidden_tooltip = { remove_trait = oathkeeper opinion = { who = ROOT modifier = opinion_stole_ice years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
				if = {
					limit = { NOT = { character = FROM } }
					hidden_tooltip = { prestige = -100 }
				}
				hidden_tooltip = { ROOT = { add_trait = ice set_character_flag = ice_reforged add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
			}
			if = {
				limit = { ROOT = { NOT = { has_character_flag = ice_reforged } }	}
				if = {
					limit = { 
						ROOT = {
							trait = ice
							dynasty = 59
						}	
					} 
					custom_tooltip = { text = TOOLTIPREREFORGEOATHKEEPERWAR }	
					hidden_tooltip = { remove_trait = oathkeeper opinion = { who = ROOT modifier = opinion_stole_ice years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
					if = {
						limit = { NOT = { character = FROM } }
						hidden_tooltip = { prestige = -100 }
					}
				}
				if = {
					limit = { 
						ROOT = {
							OR = {
								NOT = { trait = ice }
								NOT = { dynasty = 59 }
							}	
						}	
					} 
					custom_tooltip = { text = TOOLTIPRECLAIMOATHKEEPERWAR }
					hidden_tooltip = { remove_trait = oathkeeper opinion = { who = ROOT modifier = opinion_stole_oathkeeper years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
					if = {
						limit = { NOT = { character = FROM } }
						hidden_tooltip = { prestige = -100 }
					}
					hidden_tooltip = { ROOT = { add_trait = oathkeeper add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
				}
			}		
		}
		ROOT = { clr_character_flag = ice_reforged }	
		longclaw = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_longclaw }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 102 } #Mormont
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMLONGCLAWWAR }
			hidden_tooltip = { remove_trait = longclaw opinion = { who = ROOT modifier = opinion_stole_longclaw years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = longclaw add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		longclaw_snow = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_longclaw }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 102 } #Mormont
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMLONGCLAWWAR }
			hidden_tooltip = { remove_trait = longclaw_snow opinion = { who = ROOT modifier = opinion_stole_longclaw years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { 
				ROOT = { 
					if = {
						limit = { dynasty = 102 }
						add_trait = longclaw
					}	
					if = {
						limit = { NOT = { dynasty = 102 } }
						add_trait = longclaw_snow 
					}	
					add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }
				} 
			}
		}
		blackfyre = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_blackfyre }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 496 
								dynasty = 57
							}	
						}
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMBLACKFYREWAR }
			hidden_tooltip = { remove_trait = blackfyre opinion = { who = ROOT modifier = opinion_stole_blackfyre years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = blackfyre add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}
		darksister = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_darksister }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 496 }
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMDARKSISTERWAR }
			hidden_tooltip = { remove_trait = darksister opinion = { who = ROOT modifier = opinion_stole_darksister years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = darksister add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		brightroar = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_brightroar }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 190 }
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMBRIGHTROARWAR }
			hidden_tooltip = { remove_trait = brightroar opinion = { who = ROOT modifier = opinion_stole_brightroar years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = brightroar add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		heartsbane = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_heartsbane }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 296 }
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMHEARTSBANEWAR }
			hidden_tooltip = { remove_trait = heartsbane opinion = { who = ROOT modifier = opinion_stole_heartsbane years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = heartsbane add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}		
		nightfall = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_nightfall }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 122 }
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMNIGHTFALLWAR }
			hidden_tooltip = { remove_trait = nightfall opinion = { who = ROOT modifier = opinion_stole_nightfall years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = nightfall add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}		
		ladyforlorn = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_ladyforlorn }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 176 }
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMLADYFORLORNWAR }
			hidden_tooltip = { remove_trait = ladyforlorn opinion = { who = ROOT modifier = opinion_stole_ladyforlorn years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = ladyforlorn add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		redrain = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_redrain }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { 
							OR = {
								dynasty = 121
								dynasty = 197
							}	
						}
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMREDRAINWAR }
			hidden_tooltip = { remove_trait = redrain opinion = { who = ROOT modifier = opinion_stole_redrain years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = redrain add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}
		crabspincer = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_crabspincer }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 50 }
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMCRABSPINCERWAR }
			hidden_tooltip = { remove_trait = crabspincer opinion = { who = ROOT modifier = opinion_stole_crabspincer years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = crabspincer add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}
		vigilance = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_vigilance }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 285 }  
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMVIGILANCEWAR }
			hidden_tooltip = { remove_trait = vigilance opinion = { who = ROOT modifier = opinion_stole_vigilance years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = vigilance add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}
		orphan_maker = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_orphan_maker }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 247 } 
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMORPHANMAKERWAR }
			hidden_tooltip = { remove_trait = orphan_maker opinion = { who = ROOT modifier = opinion_stole_orphan_maker years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = orphan_maker add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}
		strangers_mercy = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_strangers_mercy }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMstrangers_mercyWAR }
			hidden_tooltip = { remove_trait = strangers_mercy opinion = { who = ROOT modifier = opinion_stole_strangers_mercy years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = strangers_mercy add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		palemoon = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_palemoon}
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 69157 }  
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMPALEMOONWAR }
			hidden_tooltip = { remove_trait = palemoon opinion = { who = ROOT modifier = opinion_stole_palemoon years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = palemoon add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		truth = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_truth }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 55999 } 
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMTRUTH }
			hidden_tooltip = { remove_trait = truth opinion = { who = ROOT modifier = opinion_stole_truth years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = truth add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		lamentation = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_lamentation }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 187 } 
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMLAMENTATIONWAR }
			hidden_tooltip = { remove_trait = lamentation opinion = { who = ROOT modifier = opinion_stole_lamentation years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = lamentation add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		poison = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_poison }
					AND = {
						NOT = { dynasty = ROOT }
						ROOT = { dynasty = 982375 } 
					}
				}
			}
			custom_tooltip = { text = TOOLTIPRECLAIMPOISONWAR }
			hidden_tooltip = { remove_trait = poison opinion = { who = ROOT modifier = opinion_stole_poison years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = poison add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}		
		anger = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_anger }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMangerWAR }
			hidden_tooltip = { remove_trait = anger opinion = { who = ROOT modifier = opinion_stole_anger years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = anger add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		black_death = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_black_death }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMblack_deathWAR }
			hidden_tooltip = { remove_trait = black_death opinion = { who = ROOT modifier = opinion_stole_black_death years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = black_death add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		compassion = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_compassion }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMcompassionWAR }
			hidden_tooltip = { remove_trait = compassion opinion = { who = ROOT modifier = opinion_stole_compassion years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = compassion add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		blackpaw = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_blackpaw }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMblackpawWAR }
			hidden_tooltip = { remove_trait = blackpaw opinion = { who = ROOT modifier = opinion_stole_blackpaw years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = blackpaw add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		del_pino = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_del_pino }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMdel_pinoWAR }
			hidden_tooltip = { remove_trait = del_pino opinion = { who = ROOT modifier = opinion_stole_del_pino years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = del_pino add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		el_swordo = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_el_swordo }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMel_swordoWAR }
			hidden_tooltip = { remove_trait = el_swordo opinion = { who = ROOT modifier = opinion_stole_el_swordo years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = el_swordo add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		gold_sword = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_gold_sword }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMgold_swordWAR }
			hidden_tooltip = { remove_trait = gold_sword opinion = { who = ROOT modifier = opinion_stole_gold_sword years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = gold_sword add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		happyness = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_happyness }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMhappynessWAR }
			hidden_tooltip = { remove_trait = happyness opinion = { who = ROOT modifier = opinion_stole_happyness years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = happyness add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}			
		hubris = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_hubris }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMhubrisWAR }
			hidden_tooltip = { remove_trait = hubris opinion = { who = ROOT modifier = opinion_stole_hubris years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = hubris add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		justice = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_justice }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMjusticeWAR }
			hidden_tooltip = { remove_trait = justice opinion = { who = ROOT modifier = opinion_stole_justice years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = justice add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		kingmaker = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_kingmaker }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMkingmakerWAR }
			hidden_tooltip = { remove_trait = kingmaker opinion = { who = ROOT modifier = opinion_stole_kingmaker years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = kingmaker add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		passion = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_passion }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMpassionWAR }
			hidden_tooltip = { remove_trait = passion opinion = { who = ROOT modifier = opinion_stole_passion years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = passion add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		rage = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_rage }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMrageWAR }
			hidden_tooltip = { remove_trait = rage opinion = { who = ROOT modifier = opinion_stole_rage years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = rage add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		sightblinder = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_sightblinder }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMsightblinderWAR }
			hidden_tooltip = { remove_trait = sightblinder opinion = { who = ROOT modifier = opinion_stole_sightblinder years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = sightblinder add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		the_monarchist = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_the_monarchist }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMthe_monarchistWAR }
			hidden_tooltip = { remove_trait = the_monarchist opinion = { who = ROOT modifier = opinion_stole_the_monarchist years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = the_monarchist add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		the_usurper = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_the_usurper }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMthe_usurperWAR }
			hidden_tooltip = { remove_trait = the_usurper opinion = { who = ROOT modifier = opinion_stole_the_usurper years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = the_usurper add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}		
		worldeater = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_worldeater }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMworldeaterWAR }
			hidden_tooltip = { remove_trait = worldeater opinion = { who = ROOT modifier = opinion_stole_worldeater years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = worldeater add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		worlds_envy = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_worlds_envy }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMworlds_envyWAR }
			hidden_tooltip = { remove_trait = worlds_envy opinion = { who = ROOT modifier = opinion_stole_worlds_envy years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = worlds_envy add_character_modifier = { name = owns_valyrian_steel_sword  duration = -1 }} }
		}	
		valyrian_armour = {
			limit = {
				is_alive = yes
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_stole_sword }
			}
			custom_tooltip = { text = TOOLTIPRECLAIMvalyrian_armourWAR }
			hidden_tooltip = { remove_trait = valyrian_armour opinion = { who = ROOT modifier = opinion_stole_valyrian_armour years = 100 } character_event = { id = valyrian_steel.999 days = 1 } }
			if = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { prestige = -100 }
			}
			hidden_tooltip = { ROOT = { add_trait = valyrian_armour } }
		}		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			prestige = -100
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			prestige = -150
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 150
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}
		hidden_tooltip = {
			mega_war_emperor_rebels_resolution_effect = yes
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0.75 #Less important than other CBs
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}
invasion_ironborn = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {	
		ROOT = {
			is_adult = yes
			religion = drowned_god
			prestige = 750
			piety = 250
			OR = {
				trait = ambitious
				trait = ruthless
				trait = greedy
			}
			NOT = { trait = content }
			NOT = { trait = incapable }
			NOT = { trait = on_reaving }	
			OR = {
				tier = COUNT		
				custom_tooltip = {
					text = ironborn_invasionFACTION
					hidden_tooltip = {
						OR = {
							AND = {
								NOT = { tier = EMPEROR }
								any_vassal = {
									leads_faction = faction_liege_loyalist
									faction_power = {
										faction = faction_liege_loyalist
										power = 0.75
									}
								}
							}	
							AND = {
								tier = EMPEROR
								any_vassal = {
									leads_faction = faction_crown_loyalist
									faction_power = {
										faction = faction_crown_loyalist
										power = 0.75
									}
								}
							}							
						}	
					}
				}
				custom_tooltip = {
					text = ironborn_invasionVASSALS
					hidden_tooltip = {
						NOT = { #Every capable, adult vassal is in the liege/crown loyalist faction
							any_vassal = {
								NOT = { tier = BARON }
								is_adult = yes
								prisoner = no
								religion = drowned_god
								NOT = { trait = incapable }
								NOT = { trait = kingsguard }
								NOT = { trait = archmaester }
								OR = {
									AND = {
										ROOT = { NOT = { tier = EMPEROR } }
										NOT = { in_faction = faction_liege_loyalist }
									}	
									AND = {
										ROOT = { tier = EMPEROR }
										NOT = { in_faction = faction_crown_loyalist }
									}	
								}	
							}
						}								
					}
				}
			}	
		}	
	}
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard }		
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
			NOT = { trait = nightswatch }
		}
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = { 
			culture = ironborn
			OR = {
				tier = EMPEROR
				AND = {
					independent = yes
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
				}
			}	
		}
		OR = {
			higher_tier_than = DUKE
			AND = {
				lower_tier_than = KING
				holder_scope = { 
					independent = yes 
					tier = PREV
				}
			}
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = {
			NOT = { FROM = { capital_scope = { traditional_nomad_territory_trigger = yes } } }	
			FROM = { NOT = { is_nomadic = yes } }
		}
		controls_religion = no
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}		
	}
	
	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		hidden_tooltip = { FROM = { character_event = { id = diplomatic.3099 } } } #call for aid?
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = {
			ROOT = { 
				add_character_modifier = { name = victory_timer duration = 3 }
				if = {
					limit = { has_ambition = obj_expand_realm }
					set_character_flag = obj_expand_realm_success
				}
			} 
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}	
		if = {
			limit = { FROM = { is_nomadic = yes } } #nomads pay tribute
			FROM = {
				custom_tooltip = {
					text = "REMOVE_PREVIOUS_SUZERAIN"
					hidden_tooltip = {
						any_suzerain = {
							FROM = {
								remove_tributary = PREV
							}
						}
					}
				}
			}
			ROOT = { make_tributary = { who = FROM percentage = 0.4 } }
			FROM = { #lose any non-nomad vassals
				any_vassal = {
					limit = {
						NOT = { is_nomadic = yes }
						NOT = { tier = BARON }
						lower_tier_than = ROOT
					}
					set_defacto_liege = ROOT
					hidden_tooltip = { character_event = { id = maintenance.25 } }#Subjugation flag maintenance
				}
			}
		}
		FROM = {
			prestige = -200
		}
	}

	on_success_title = {
		holder_scope = { save_event_target_as = old_usurped_title_holder }
		if = {
			limit = { FROM = { NOT = { is_nomadic = yes } } }
			custom_tooltip = { text = invasion_succ_tip }	 
			hidden_tooltip = {
				ROOT = {
					occupy_minors_of_occupied_settlements = FROM
					gain_all_occupied_titles = FROM					
				}
				if = { #Check if title is supposed to have gavelkind
					limit = { has_law = succ_gavelkind }
					ROOT = { set_character_flag = ironborn_invasion_gavelkind }
				}
				if = { #Euron give shield isle lordships
					limit = { 
						title = k_reach
						ROOT = { has_character_flag = euron_shield_isles }
					} 
					ROOT = {
						clr_character_flag = euron_shield_isles
						random_realm_character = {
							limit = { has_character_flag = maron_volmark } #Maron Volmark
							c_greenshield = { 
								grant_title = PREV 
								hidden_tooltip = { any_de_jure_vassal_title = { gain_title = PREVPREV } }
							}
							set_defacto_liege = ROOT
						}
						random_realm_character = {
							limit = { has_nickname = nick_the_barber } #Nute the Barber
							c_oakenshield = { 
								grant_title = PREV 
								hidden_tooltip = { any_de_jure_vassal_title = { gain_title = PREVPREV } }
							}
							set_defacto_liege = ROOT
						}	
						random_realm_character = {
							limit = { has_nickname = nick_the_unsmiling } #Andrik the Unsmiling
							c_southshield = { 
								grant_title = PREV 
								hidden_tooltip = { any_de_jure_vassal_title = { gain_title = PREVPREV } }
							}
							set_defacto_liege = ROOT
						}	
						random_realm_character = {
							limit = { has_nickname = nick_the_knight } #Harras Harlaw
							c_greyshield = { 
								grant_title = PREV 
								hidden_tooltip = { any_de_jure_vassal_title = { gain_title = PREVPREV } } 
							}
							set_defacto_liege = ROOT
						}	
					}	
				}
				holder_scope = {
					if = {
						limit = { government = alliance_government } #disband alliance
						set_character_flag = conquest
						character_event = { id = free_cities.15 tooltip = TOOLTIPfree_cities.15 } 
					}
					PREV = {
						usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion } 
					}
					set_defacto_liege = ROOT
					character_event = { id = maintenance.25 } #Subjugation flag maintenance
				}	
				ROOT = { 
					
					character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
				}
				if = { #If title has become gavelkind by error change to agantic primogeniture
					limit = { 
						has_law = succ_gavelkind 
						ROOT = { NOT = { has_character_flag = ironborn_invasion_gavelkind } }
					}
					succession = primogeniture
					gender_succ = agnatic
				}
				ROOT = { clr_character_flag = ironborn_invasion_gavelkind }
			}	
			if = {
				limit = {
					higher_tier_than = BARON
					NOT = { culture = ROOT }
				}
				hidden_tooltip = { conquest_culture = ROOT }
			}
			clear_event_target = old_usurped_title_holder
		}	
	}
	
	on_fail = {
		ROOT = {
			prestige = -200
			clr_character_flag = euron_shield_isles			
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 8.0
			}
			any_child = {
				limit = { 
					has_character_flag = theon_greyjoy
					FROM = { character = 2059 }
				}
				imprison = FROM
				set_character_flag = captured_in_battle
			}
			clr_character_flag = euron_shield_isles
			custom_tooltip = { text = TOOLTIPlootvengeancereturnlootinvasion }	 
		}
		FROM = {
			hidden_tooltip = { character_event = { id = raid_events.105 } }
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	on_reverse_demand_title = {
		remove_claim = ROOT
	}

	on_attacker_leader_death = {
		# hidden_tooltip = {
			# any_defender = {
				# letter_event = {
					# id = 251
				# }
			# }
		# }

		# end_war = whitepeace
	}

	attacker_ai_victory_worth = {
		factor = 150
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 2
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
		modifier = { #Dont attack tributaries with strong suzerain
			factor = 0
			FROM = { 
				is_tributary = yes
				suzerain = {
					OR = {
						relative_power = { who = ROOT power = 1.5 }
						reverse_opinion = { who = ROOT value = 50 }
					}
				}
			}
		}		
	}
}
#IRONBORN RAID GOES HERE, OBSOLETE
# ironborn_raid = {
	# name = CB_NAME_IRONBORN_RAID
	# war_name = WAR_NAME_IRONBORN_RAID
	# sprite = 6
	# truce_days = 720
	# is_permanent = yes	
	# attacker_can_call_allies = yes
	# hostile_against_others = yes

	# infamy_modifier = 0

	# can_use = {
		# ROOT = {
			# religion_group = drowned_god_group 
			# culture = ironborn
			# NOT = { trait = on_reaving }
			# NOT = { trait = nightswatch }
			# NOT = { trait = kingsguard }
			# NOT = { trait = archmaester }
			# NOT = { trait = maester }
			# NOT = { any_liege = { primary_title = { title = d_nightswatch } } }
			# NOT = { same_realm = FROM }	
		# }
		# FROM = {
			# NOT = { primary_title = { title = d_nightswatch } }
			# NOT = { any_liege = { primary_title = { title = d_nightswatch } } }
			# OR = {
				# NOT = { trait = wildling }
				# higher_tier_than = DUKE	
			# }	
			# OR = {
				# NOT = { religion_group = drowned_god_group }
				# NOT = { culture = ironborn }
			# }	
		# }
	# }	
	
	# is_valid = {		
		# ROOT = {
			# religion_group = drowned_god_group 
			# culture = ironborn
			# NOT = { primary_title = { title = d_nightswatch } }
			# NOT = { any_liege = { primary_title = { title = d_nightswatch } } }
		# }
		# FROM = {
			# NOT = { primary_title = { title = d_nightswatch } }
			# NOT = { any_liege = { primary_title = { title = d_nightswatch } } }
		# }
	# }
	
	# on_success = {
		# hidden_tooltip = { 
			# ROOT = { 
				# add_character_modifier = { name = victory_timer duration = 3 } 
				# if = {
					# limit = { in_command = yes }
					# character_event = { id = raid_events.4 days = 5 }
				# }	
				# any_realm_character = {
					# limit = { 
						# in_command = yes 
						# NOT = { is_primary_war_attacker = yes } 
						# NOT = { is_primary_war_defender = yes } 
					# }
					# character_event = { id = raid_events.4 days = 5 }
					# opinion = {
						# modifier = opinion_on_reaving
						# who = ROOT
						# days = 6
					# }
				# }
			# } 
		# } 
		# FROM = {
			# transfer_scaled_wealth = {
				# to = ROOT
				# value = 2.0
			# }
		# }
		# any_attacker = {
			# participation_scaled_prestige = 100
			# participation_scaled_piety = 25
			# #FROM = {
			# #	transfer_scaled_wealth = {
			# #		to = PREVPREV
			# #		value = 0.25
			# #	}
			# #}
			
		# }
		
	# }

	# on_fail = {
		# any_defender = {
			# participation_scaled_prestige = 50
			# participation_scaled_piety = 15
		# }
	# }

	# on_reverse_demand = {
		# hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		# ROOT = {
			# prestige = -100	
			# imprison = FROM
		# }
		# FROM = {
			# prestige = 100		
		# }
		# hidden_tooltip = {
			# mega_war_emperor_rebels_resolution_effect = yes
		# }
	# }

	# attacker_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# attacker_ai_defeat_worth = {
		# factor = 100
	# }

	# defender_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# defender_ai_defeat_worth = {
		# factor = 40
	# }
	
	# # ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	# ai_will_do = { 
		# factor = 1
		# #Dragon intimidation
		# modifier = {
			# factor = 0.1
			# ROOT = { NOT = { trait = dragon_rider } }
			# FROM = { 
				# trait = dragon_rider 
				# NOT = { trait = incapable }
			# }
		# }	
		# #Should prefer invasion if eligible
		# modifier = {
			# factor = 0.15
			# tier = EMPEROR
		# }	
	# }
# }
# Restore the nightswatch
restore_nightswatch = {
	name = CB_RESTORE_NIGHTSWATCH
	war_name = WAR_NAME_RESTORE_NIGHTSWATCH
	sprite = 8
	truce_days = 365
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	attacker_can_call_allies = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	press_claim = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	
	infamy_modifier = 0
	
	can_use_gui = {
		ROOT = {
			nightswatch_culture_trigger = yes
			custom_tooltip = {
				text = TOOLTIPrestore_nightswatchNEIGHBOUR
				hidden_tooltip = {
					any_realm_province = { #must neighbour
						any_neighbor_province = {
							owner = {
								OR = {
									character = FROM
									is_liege_or_above = FROM
								}
							}
						}
					}
				}
			}
		}	
	}
	
	can_use_title = {
		OR = {
			title = d_the_wall
			AND = {
				dejure_liege_title = { title = d_the_wall }
				holder_scope = { NOT = { has_landed_title = d_the_wall } }
			}	
		}	
		holder_scope = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
			OR = {
				trait = wildling
				any_liege = { trait = wildling }
				has_character_modifier = NW_broken_vows
				has_landed_title = k_nightswatch					
			}	
		}
	}

	can_use = {
		ROOT = { 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
			NOT = { trait = kingsguard }
			NOT = { trait = wildling }
			NOT = { top_liege = { trait = wildling } }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }		
		}	
	}
	
	is_valid_title = {
		OR = {
			title = d_the_wall
			AND = {
				dejure_liege_title = { title = d_the_wall }
				holder_scope = { NOT = { has_landed_title = d_the_wall } }
			}	
		}	
		holder_scope = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
			OR = {
				trait = wildling
				any_liege = { trait = wildling }
				has_character_modifier = NW_broken_vows
				has_landed_title = k_nightswatch					
			}	
		}
	}
	
	on_add = {
		if = { #Add other wildlings on the wall as defenders
			limit = { FROM = { trait = wildling } }
			any_independent_ruler = {
				limit = {
					NOT = { character = FROM }
					trait = wildling
					any_demesne_title = {
						OR = {
							title = d_the_wall
							dejure_liege_title = { title = d_the_wall }
						}
					}
				}
				join_defender_wars = FROM
			}
		}	
		event_target:chronicle_player = {
			if = {
				limit = { NOT = { character = FROM } }
				chronicle = {
					entry = CHRONICLE_WAR_RESTORE_WATCH
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_RESTORE_WATCH_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
		}
		
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		#If broken vows, abdicate
		if = {
			limit = { 
				FROM = { 
					has_character_modifier = NW_broken_vows
					NOT = { has_landed_title = k_nightswatch }
				} 
			}
			FROM = {
				imprison = ROOT 
				clr_character_flag = captured_in_battle
				hidden_tooltip = { #Universal on death/abdication event
					any_vassal = {
						limit = { NOT = { trait = nightswatch } }
						set_defacto_liege = THIS
					}
					if = {
						limit = { has_character_modifier = owns_valyrian_steel_sword }
						set_character_flag = do_not_inherit_sword
					}
					set_character_flag = abdication
					character_event = { id = 45341 } 
					clr_character_flag = abdication
					clr_character_flag = do_not_inherit_sword
					if = {
						limit = { is_merchant_republic = no }
						current_heir = { save_event_target_as = wealth_heir }
					}
					if = {
						limit = { is_merchant_republic = yes }
						family_palace = { current_heir = { save_event_target_as = wealth_heir } }
					}
					transfer_scaled_wealth = { to = event_target:wealth_heir value = all }
				}
				abdicate = yes								
			}
		}
		#If Night's King, Destroy title
		if = {
			limit = { FROM = { has_landed_title = k_nightswatch } }
			k_nightswatch = { destroy_landed_title = FROM }
			FROM = { imprison = ROOT clr_character_flag = captured_in_battle }
			hidden_tooltip = { 
				FROM = { 
					any_vassal = {
						limit = { NOT = { trait = nightswatch } }
						set_defacto_liege = THIS
					}
					spouse = { imprison = ROOT clr_character_flag = captured_in_battle }
					d_nightswatch = {
						succession = open_elective
						gender_succ = agnatic 
						holder_scope = {
							recalc_succession = yes
							hidden_tooltip = { #Universal on death/abdication event
								if = {
									limit = { has_character_modifier = owns_valyrian_steel_sword }
									set_character_flag = do_not_inherit_sword
								}
								set_character_flag = abdication
								character_event = { id = 45341 } 
								clr_character_flag = abdication
								clr_character_flag = do_not_inherit_sword
								if = {
									limit = { is_merchant_republic = no }
									current_heir = { save_event_target_as = wealth_heir }
								}
								if = {
									limit = { is_merchant_republic = yes }
									family_palace = { current_heir = { save_event_target_as = wealth_heir } }
								}
								transfer_scaled_wealth = { to = event_target:wealth_heir value = all }
							}
							abdicate = yes
						}
					}				
				} 				
			}
		}
		#If Night's watch doesn't exist, victor nominates new LC
		if = {
			limit = {
				d_nightswatch = { 
					OR = {
						has_holder = no 
						holder_scope = { trait = wildling }
					}	
				}				
			}
			hidden_tooltip = { 
				d_nightswatch_dummy = { copy_title_history = d_nightswatch } 
				activate_title = { status = yes title = d_nightswatch }
			}	
			if = { #Player has 10 days to pick their own LC
				limit = { ROOT = { ai = no } }
				d_nightswatch = { gain_title = ROOT }
				d_the_wall = {
					if = {
						limit = { holder_scope = { same_realm = FROM } }
						usurp_title = ROOT
					}
					hidden_tooltip = {
						any_de_jure_vassal_title = {
							limit = { holder_scope = { same_realm = FROM } }
							usurp_title = ROOT
						}
					}	
				}
				ROOT = {
					custom_tooltip = {
						text = TOOLTIPPLAYERESTOREDNW
						hidden_tooltip = { character_event = { id = nightswatch.112 days = 10 } }
					}
				}
			}
			if = { #AI picks one immediately
				limit = { ROOT = { ai = yes } }
				ROOT = {
					random_realm_character = {
						limit = {
							is_female = no
							age = 16
							is_primary_heir = no
							NOT = { any_pretender_title = { always = yes } }
							NOT = { any_heir_title = { always = yes } }
							is_ruler = no
							is_married = no
							OR = {
								trait = widowed
								NOT = { num_of_children = 1 }
							}	
							NOT = { trait = maester }
							NOT = { trait = kingsguard }
							NOT = { trait = archmaester }
							is_priest = no
							prisoner = no
							NOT = { trait = incapable }
							religion = PREV
							reverse_opinion = { who = PREV value = 20 }	
							opinion = { who = PREV value = 20 }							
						}
						add_trait = nightswatch
						d_nightswatch = { gain_title = PREV }
						set_government_type = NW_government
					}
					if = {
						limit = { d_nightswatch = { has_holder = no } }
						custom_tooltip = { text = TOOLTIPRESTORENWRANDOM }
						hidden_tooltip = {
							capital_scope = {
								ROOT = {
									create_random_steward = {
										random_traits = yes
										dynasty = random
										female = no
										culture = PREV
										religion = PREV
									}
									new_character = {
										add_trait = nightswatch
										d_nightswatch = { gain_title = PREV }
										set_government_type = NW_government
									}
								}
							}
						}
					}
				}
			}
		}
		
		#if Lord Commander isnt wildling restore independance
		if = {
			limit = {
				d_nightswatch = {
					holder_scope = {
						NOT = { character = ROOT }
						NOT = { trait = wildling }
						NOT = { has_character_modifier = NW_broken_vows }
						NOT = { has_landed_title = k_nightswatch }
					}
				}	
			}
			d_nightswatch = {
				holder_scope = {				
					character_event = { id = nightswatch.21 tooltip = TOOLTIPnightswatch.21 } #Gets Lands Back
					set_defacto_liege = THIS
					hidden_tooltip = {
						any_vassal = {
							limit = { NOT = { trait = nightswatch } }
							set_defacto_liege = THIS
						}
						opinion = {
							who = ROOT
							modifier = opinion_very_grateful
							years = 10
						}					
					}
				}
			}
		}
		any_attacker = {
			participation_scaled_prestige = 200
		}
		FROM = {
			prestige = -100
		}
	}

	on_fail = {
		ROOT = {
			prestige = -200
		}
		any_defender = {
			participation_scaled_prestige = 100
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			participation_scaled_prestige = 150
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0.75
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}
dragon_conquest = {
	name = CB_DRAGON_CONQUEST
	war_name = WAR_NAME_DRAGON_CONQUEST
	sprite = 28
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		ROOT = {
			can_use_dragon_conquest_trigger = yes
		}
		custom_tooltip = {
			text = TOOLTIPCBNOWILDLINGS
			hidden_tooltip = {
				FROM = {
					OR = {
						NOT = { trait = wildling }
						ROOT = { trait = wildling }
					}
				}
			}
		}
		FROM = { independent = yes }
		OR = { #Must be king or higher to atack the triarchy
			ROOT = { higher_tier_than = DUKE }
			FROM = { NOT = { government = alliance_government } }
		}
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}

	can_use_title = {
		ROOT = {
			trait = dragon_rider
			NOT = { has_character_flag = danys_eastern_quest } #Dany cannot use until quest is complete
		}	
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}		
		FROM = {
			independent = yes
			primary_title = { title = PREVPREV }	
		}
		OR = { #Can only conquer a religion head if higher tier
			controls_religion = no
			ROOT = { higher_tier_than = FROM }
		}
		
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	is_valid_title = {
		ROOT = {
			independent = yes
			NOT = { trait = nightswatch }
		}
		FROM = {
			independent = yes	
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add = { 
		hidden_tooltip = { FROM = { character_event = { id = diplomatic.3099 } } } #call for aid?
		FROM = { #Surrender option
			if = {
				limit = { NOT = { has_character_flag = crownlander_resists } NOT = { trait = dragon_rider } }
				set_character_flag = considering_surrender
				character_event = { id = dragon.67 days = 3 tooltip = TOOLTIPdragon.67 } 
			}	
		}	
		hidden_tooltip = {
			ROOT = {
				if = { #disallow raising of levies whilst surrender is considered
					limit = { tier = EMPEROR }
					add_character_modifier = {
						name = mega_war_no_levies
						duration = 14
						hidden = yes
					}
				}	
			}
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_DRAGON_CONQUEST_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_DRAGON_CONQUEST_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_DRAGON_CONQUEST_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_DRAGON_CONQUEST_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		if = {
			limit = {
				FROM = { 
					OR = {
						tier = KING
						tier = EMPEROR
					}	
				}
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 300
			}
			hidden_tooltip = {
				any_attacker = {
					limit = { NOT = { character = ROOT } }
					participation_scaled_prestige = 300
				}
			}
			FROM = {
				prestige = -150
			}
		}	
		if = {
			limit = {
				FROM = { tier = DUKE }
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 150
			}
			hidden_tooltip = {
				any_attacker = {
					limit = { NOT = { character = ROOT } }
					participation_scaled_prestige = 150
				}
			}
			FROM = {
				prestige = -75
				clr_character_flag = crownlander_resists
			}
		}
		if = {
			limit = {
				FROM = { tier = COUNT }
			}
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 80
			}
			hidden_tooltip = {
				any_attacker = {
					limit = { NOT = { character = ROOT } }
					participation_scaled_prestige = 80
				}
			}
			FROM = {
				prestige = -40
				clr_character_flag = crownlander_resists
			}
		}
	}
	
	on_success_title = {
		hidden_tooltip = { 
			ROOT = { 
				add_character_modifier = { name = victory_timer duration = 3 }
				if = {
					limit = { has_ambition = obj_expand_realm }
					set_character_flag = obj_expand_realm_success
				}
				if = { #Volantene New Valyria Ambition
					limit = { 
						has_landed_title = e_new_valyria
						has_global_flag = e_new_valyria_ambition
					}
					clr_global_flag = e_new_valyria_ambition
				}
			}
		} 
		hidden_tooltip = {
			holder_scope = { save_event_target_as = old_usurped_title_holder }
			mega_war_rebel_leader_resolution_effect = yes		
		}
		if = {
			limit = { FROM = { is_nomadic = yes } } #nomads pay tribute
			FROM = {
				custom_tooltip = {
					text = "REMOVE_PREVIOUS_SUZERAIN"
					hidden_tooltip = {
						any_suzerain = {
							FROM = {
								remove_tributary = PREV
							}
						}
					}
				}
			}
			ROOT = { make_tributary = { who = FROM percentage = 0.4 } }
			FROM = { #lose any non-nomad vassals
				any_vassal = {
					limit = {
						NOT = { is_nomadic = yes }
						NOT = { tier = BARON }
						lower_tier_than = ROOT
					}
					set_defacto_liege = ROOT
					hidden_tooltip = { character_event = { id = maintenance.25 } }#Subjugation flag maintenance
				}
			}
		}
		
		hidden_tooltip = {
			holder_scope = {
				remove_trait = rebel_leader
			}
			if = {
				limit = { FROM = { NOT = { is_nomadic = yes } } }
				FROM = {
					if = { #end all revolts
						limit = { primary_title = { NOT = { lower_tier_than = ROOT } } }
						any_war = {
							limit = { 
								attacker = { 
									liege_before_war = { character = PREVPREVPREV }
									NOT = { character = ROOT }
								} 
							}
							end_war = invalid
						}
					}
				}
			}	
		}
		if = {
			limit = { FROM = { NOT = { is_nomadic = yes } } }
			if = {
				limit = { ROOT = { tier = EMPEROR } }	
				if = {
					limit = { 
						FROM = { 
							OR = {
								tier = EMPEROR
								tier = KING
							}
						} 
					}
					hidden_tooltip = {
						ROOT = {
							if = {
								limit = { NOT = { check_variable = { which = "kingdoms_conquered" value = 0 } } }
								set_variable = { which = "kingdoms_conquered" value = 1 }
							}
							if = {
								limit = { check_variable = { which = "kingdoms_conquered" value = 0 } } 
								change_variable = { which = "kingdoms_conquered" value = 1 }
							}
							if = {
								limit = { has_global_flag = aegons_conquest } 
								character_event = { id = aegons_landing.4 days = 2 }
								character_event = { id = aegons_landing.5 days = 2 }
								narrative_event = { id = aegons_landing.9 days = 2 }
								character_event = { id = aegons_landing.410 days = 2 }
								narrative_event = { id = aegons_landing.90 days = 2 }
							}
						}	
					}
				}
				if = {
					limit = { FROM = { tier = EMPEROR } }
					FROM = {
						if = {
							limit = { ROOT = { tier = EMPEROR } }
							any_vassal = {
								limit = { tier = KING }
								if = {
									limit = { ROOT = { trait = civil_war } }
									set_character_flag = neutral
									custom_tooltip = { text = TOOLTIPdejure_kingdom_EMP_vassal }
									hidden_tooltip = { character_event = { id = mega_wars.52 } }
								}
								if = {
									limit = { ROOT = { NOT = { trait = civil_war } } }
									character_event = { id = mega_wars.52 tooltip = EVTTOOLTIPmega_wars.52 }
								}	
							}
						}	
						if = { 	limit = { primary_title = { title = e_north } }
								k_north = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
						}
						if = { 	limit = { primary_title = { title = e_riverlands } }
								k_riverlands  = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
						}
						if = { 	limit = { primary_title = { title = e_vale } }
								k_vale = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
						}
						if = { 	limit = { primary_title = { title = e_westerlands } }
								k_westerlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
						}
						if = { 	limit = { primary_title = { title = e_reach } }
								k_reach = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
						}
						if = { 	limit = { primary_title = { title = e_stormlands } }
								k_stormlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
						}
						if = { 	limit = { primary_title = { title = e_dorne } }
								k_dorne = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
						}
						if = { 	limit = { primary_title = { title = e_iron_isles } }
								k_iron_isles = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } } 
						}
						tooltip = { set_defacto_liege = ROOT }
						hidden_tooltip = { 
							if = {
								limit = { government = alliance_government } #disband alliance
								set_character_flag = conquest
								character_event = { id = free_cities.15 tooltip = TOOLTIPfree_cities.15 } 
							}
							character_event = { id = maintenance.20 } #This event takes the defeated King's title and reorganises them
						} 
					}
				}
				if = {
					limit = { FROM = { NOT = { tier = EMPEROR } } }
					FROM = { 
						set_defacto_liege = ROOT
					}
				}	
			}
			if = {
				limit = { ROOT = { NOT = { tier = EMPEROR } } }
				if = {
					limit = { FROM = { NOT = { lower_tier_than = ROOT } } }
					FROM = { 
						if = {
							limit = { government = alliance_government } #disband alliance
							set_character_flag = conquest
							character_event = { id = free_cities.15 tooltip = TOOLTIPfree_cities.15 } 
						}
						any_demesne_title = {
							limit = { 
								tier = ROOT_FROM
								NOT = { lower_tier_than = ROOT }
								is_landless_type_title = no
							}
							usurp_title = { target = ROOT type = invasion }
						}
					}
				}
				FROM = { set_defacto_liege = ROOT }
			}
			FROM = { #if has equivalent landless title, usurp all lower titles
				if = { 
					limit = { 					
						any_demesne_title = { 
							is_landless_type_title = yes 
							NOT = { lower_tier_than = ROOT }
						}
						NOT = { lower_tier_than = ROOT }
					}
					any_demesne_title = {
						limit = { is_landless_type_title = no }
						usurp_title = { target = ROOT type = invasion }
					}
				}	
			}	
			ROOT = {
				if = {
					limit = {
						check_variable = { which = "kingdoms_conquered" value = 5 }
						has_nickname = no
					}
					give_nickname = nick_the_conqueror
				}
			}
			hidden_tooltip = {			
				FROM = {
					if = {
						limit = { is_liege_or_above = ROOT }
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}	
				}
				ROOT = { 					
					character_event = { id = maintenance.24 } #Mega war flag maintenance
					character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
				} 
				FROM = { character_event = { id = diplomatic.51 days = 2 } } #destroy redundant kingdoms
				if = {
					limit = { title = e_iron_throne } #Lose crownlands
					holder_scope = { character_event = { id = maintenance.37 } } 
				}
				ROOT = {
					if = {
						limit = { 
							has_global_flag = aurions_conquest 
							character = 50012300	
						} 
						if = {
							limit = {
								PREV = { title = e_new_valyria }
							}
							clr_global_flag = e_new_valyria_ambition
							c_oldvolantis = { usurp_title = ROOT }
							k_volantis = { usurp_title = ROOT }
							b_rhoyne_manor = { 
								usurp_title = ROOT 
								province_capital = yes
								ROOT = { capital = PREV }							
							}							
							d_volantis = { gain_title = ROOT_FROM }
							b_oldvolantis = {
								gain_title = ROOT_FROM
								ROOT_FROM = { capital = PREV }
								remove_holding_modifier = recently_conquered
								remove_holding_modifier = new_administration
							}
							any_vassal = {
								limit = { 
									is_patrician = yes
									is_merchant_republic = no
									lower_tier_than = ROOT_FROM
									NOT = { character = ROOT_FROM }
								}
								set_defacto_liege = ROOT_FROM
							}
						}	
						disband_event_forces = aurions_fleet
						clr_global_flag = aurions_conquest 
						activate_title = { status = no title = e_aurions_host }
						e_aurions_host = { destroy_landed_title = ROOT }
					}
				}	
			}
		}	
		clear_event_target = old_usurped_title_holder
	}
	
	on_fail = {
		ROOT = {
			prestige = -100
			hidden_tooltip = {
				if = {
					limit = { has_global_flag = aegons_conquest } 
					FROM = { set_character_flag = defended_conquest }
					character_event = { id = aegons_landing.4 days = 2 }
					character_event = { id = aegons_landing.5 days = 2 }
					narrative_event = { id = aegons_landing.6 days = 2 }
					narrative_event = { id = aegons_landing.61 days = 2 }
					narrative_event = { id = aegons_landing.9 days = 2 }
					character_event = { id = aegons_landing.410 days = 2 }
					narrative_event = { id = aegons_landing.90 days = 2 }
				}
			}
			if = { #Volantene New Valyria Ambition
				limit = { 
					has_landed_title = e_new_valyria
					has_global_flag = e_new_valyria_ambition
					e_new_valyria = { NOT = { any_war = { attacker = { NOT = { character = ROOT } } } } }
				}
				clr_global_flag = e_new_valyria_ambition
				e_new_valyria = { 
					destroy_landed_title = ROOT 
					hidden_tooltip = { set_variable = { which = "de_facto_empire" value = 11 } }
				}
			}
			if = { #if aurion has lost all forces, lose title
				limit = { 
					has_global_flag = aurions_conquest 
					character = 50012300	
					NOT = { relative_power = { who = FROM power = 0.025 } }
				} 
				disband_event_forces = aurions_host
				disband_event_forces = aurions_fleet
				clr_global_flag = aurions_conquest 
				activate_title = { status = no title = e_aurions_host }
				e_aurions_host = { destroy_landed_title = ROOT }
				imprison = FROM
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			clr_character_flag = crownlander_resists
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }	
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			hidden_tooltip = {
				if = {
					limit = { has_global_flag = aegons_conquest } 
					FROM = { set_character_flag = defended_conquest }
					character_event = { id = aegons_landing.4 days = 2 }
					character_event = { id = aegons_landing.5 days = 2 }
					narrative_event = { id = aegons_landing.6 days = 2 }
					narrative_event = { id = aegons_landing.61 days = 2 }
					narrative_event = { id = aegons_landing.9 days = 2 }
					character_event = { id = aegons_landing.410 days = 2 }
					narrative_event = { id = aegons_landing.90 days = 2 }
				}
				if = {
					limit = { 
						has_global_flag = aurions_conquest 
						character = 50012300					
					} 
					disband_event_forces = aurions_host
					disband_event_forces = aurions_fleet
					clr_global_flag = aurions_conquest 
					activate_title = { status = no title = e_aurions_host }
					e_aurions_host = { destroy_landed_title = ROOT }
					imprison = FROM
				}
			}
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			if = { #Volantene New Valyria Ambition
				limit = { 
					has_landed_title = e_new_valyria
					has_global_flag = e_new_valyria_ambition
					e_new_valyria = { NOT = { any_war = { attacker = { NOT = { character = ROOT } } } } }
				}
				clr_global_flag = e_new_valyria_ambition
				e_new_valyria = { 
					destroy_landed_title = ROOT 
					hidden_tooltip = { set_variable = { which = "de_facto_empire" value = 11 } }
				}
			}
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
			clr_character_flag = crownlander_resists
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	on_attacker_leader_death = {
		ROOT = {
			hidden_tooltip = {
				if = {
					limit = { 
						has_global_flag = aurions_conquest 
						character = 50012300					
					} 
					disband_event_forces = aurions_host
					disband_event_forces = aurions_fleet
					clr_global_flag = aurions_conquest 
					activate_title = { status = no title = e_aurions_host }
					e_aurions_host = { destroy_landed_title = ROOT }
				}
			}	
		}
		end_war = invalid
		FROM = { clr_character_flag = considering_surrender }
	}
	
	on_invalidation = {
		FROM = { clr_character_flag = considering_surrender }
	}
	
	attacker_ai_victory_worth = {
		factor = -1
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 2
		#Dorne Reluctance
		modifier = {
			factor = 0.1
			ROOT = { has_landed_title = e_iron_throne }
			FROM = { 
				primary_title = { title = e_dorne }
			}
		}	
		modifier = {
			factor = 0
			ROOT = { 
				has_landed_title = e_iron_throne 
				NOT = { trait = ambitious }
				NOT = { trait = greedy }	
			}
			FROM = { 
				primary_title = { title = e_dorne }
			}
		}
		modifier = { #Dont attack tributaries with strong suzerain
			factor = 0
			FROM = { 
				is_tributary = yes
				suzerain = {
					OR = {
						AND = {
							trait = dragon_rider
							relative_power = { who = ROOT power = 1.5 }
						}
						relative_power = { who = ROOT power = 4 }
						reverse_opinion = { who = ROOT value = 50 }
					}
				}
			}
		}
	}	
}
dynasty_plot_claim = {
	name = CB_NAME_WEAKEN_VASSAL
	war_name = WAR_NAME_WEAKEN_VASSAL
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes

	press_claim = yes
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_title = {
		ROOT = { has_plot = plot_dynasty_claim }
		FROM = {
			has_landed_title = PREV
		}
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
		}
	}

	is_valid = {
		ROOT = { 
			any_dynasty_member = {
				has_character_flag = dynasty_claim_target
				is_alive = yes
			}	
		}	
	}
	
	on_add_title = {
		hidden_tooltip = { 
			FROM = { 
				if = {
					limit = {
						OR = {
							is_theocracy = yes
							is_republic = yes
						}
					}
					character_event = { id = diplomatic.3099 } #call for aid?
				}	
			} 
		}
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_DYNASTY_PLOT_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_DYNASTY_PLOT_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_DYNASTY_PLOT_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_DYNASTY_PLOT_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		any_attacker = {
			participation_scaled_prestige = 100
		}
	}
	
	on_success_title = {
		hidden_tooltip = { holder_scope = { character_event = { id = maintenance.22 days = 2 } } }#Mega War flag maintenance
		ROOT = {
			random_dynasty_member = {
				limit = {
					has_character_flag = dynasty_claim_target
					is_alive = yes
				}
				hidden_tooltip = {
					if = { 	
						limit = {	
							FROM = { has_character_flag = post_civil_war_wars }
						}
						set_character_flag = post_civil_war_wars
					}
					if = { 	
						limit = {	
							FROM = { 
								OR = {
									has_character_flag = supporting_king 
									has_character_flag = neutral 
									has_character_flag = against_king 
								}		
							}
							lower_tier_than = PREVPREV
						}
						set_character_flag = neutral
					}
					opinion = {
						modifier = pressed_my_claim 
						who = ROOT
					}
				}	
				usurp_title = { target = PREVPREV type = claim }
			}
		}
		hidden_tooltip = {
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } } 
			}
		}		
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			imprison = FROM
			clr_character_flag = captured_in_battle
		}
		any_attacker = {
			limit = {
				has_character_flag = dynasty_claim_target
			}
			imprison = FROM
			clr_character_flag = captured_in_battle
		}	
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	on_attacker_leader_death = {
		any_defender = {
			letter_event = {
				id = 251
			}
		}
		ROOT = {
			if = {
				limit = {
					has_character_flag = rebel_leader
				}
				e_iron_throne = {
					holder_scope = {
						character_event = { id = mega_wars.8 }
					}
				}
			}
			
		}
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}
native_revolt = {
	name = CB_NAME_NATIVE_REVOLT
	war_name = WAR_NAME_NATIVE_REVOLT
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	is_permanent = no
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	is_independence = yes
	
	defender_can_call_allies = no

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			primary_title = { temporary = yes } # Revolter or adventurer trigger
			war = no
			NOT = { is_liege_or_above = FROM }
		}
	}

	can_use_title = {
		tier = count
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		NOT = { holder_scope = { culture = ruin } }
	}

	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		location = {		
			if = {
				limit = {
					NAND = {
						NOT = { has_province_flag = ruined_province }
						traditional_nomad_territory_trigger = yes
					}
				}
				custom_tooltip = { text = TOOLTIPnative_revolt }
				
			}	
			if = { #nomad takeover
				limit = {
					NOT = { has_province_flag = ruined_province }
					traditional_nomad_territory_trigger = yes
				}				
				county = { usurp_title = ROOT }
				hidden_tooltip = {
					ROOT = {
						if = { #native revolter
							limit = { has_character_flag = native_nomad_usurper }
							create_title = {
								tier = DUKE
								#landless = yes
								#adventurer = yes
								culture = ROOT
								#name = "DOTHRAKI_ADVENTURE"
								holder = ROOT
							}
						}	
					}	
				}
			}	
			hidden_tooltip = { 
				province_event = { id = unoccupied.7 }
				culture = ROOT
				religion = ROOT
			}			
		}
		FROM = {
			prestige = -100
			change_variable = { which = fear_actions value = -20 }
		}
	}

	on_fail_title = {
		FROM = {
			prestige = 10
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = { 
			imprison = FROM
			clr_character_flag = captured_in_battle
			clr_character_flag = native_nomad_usurper
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			prestige = 20
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = { 
			imprison = FROM
			clr_character_flag = captured_in_battle
			clr_character_flag = native_nomad_usurper
		}
	}
	
	on_invalidation = {
		ROOT = { 
			clr_character_flag = native_nomad_usurper
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}
###Colonisation
colonisation = {
	name = CB_NAME_COLONISATION
	war_name = WAR_NAME_COLONISATION
	sprite = 7
	truce_days = 365
	#hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	attacker_can_call_allies = no
	
	allow_distant = yes # AI parameter
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		custom_tooltip = { #Must neighbour ruin, or be within two sea zones
			text = TOOLTIPcolonisation
			# hidden_tooltip = {
				# FROM = { 
					# any_demesne_province = { 
						
					# }	
				# }	
			# }
		}	
		ROOT = { 
			OR = {
				AND = {
					has_game_rule = { name = colinisation_cost value = expensive }
					wealth = 800
				}	
				AND = {
					has_game_rule = { name = colinisation_cost value = normal }
					wealth = 500 
				}
				AND = {
					has_game_rule = { name = colinisation_cost value = cheap }
					wealth = 200
				}
			}	
		}
		# custom_tooltip = {
			# text = TOOLTIPcolonisationCOST
			# hidden_tooltip = {
				# OR = {
					# ROOT = { wealth = 1000 }
					# AND = {
						# ROOT = { wealth = 500 }
						# FROM = { NOT = { culture_group = unoccupied_group } }
					# }
				# }	
			# }
		# }	
	}
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard }
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
			NOT = { is_nomadic = yes }
			is_tribal = no
		}
		tier = COUNT
		location = { 
			OR = {
				has_province_flag = ruined_province
				traditional_nomad_territory_trigger = yes
			}	
			NOT = { has_province_flag = colony_province }
			
			any_neighbor_province = { #Must neighbour ruin, or be within two sea zones
				OR = {
					AND = {
						has_owner = yes
						OR = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT										
								}
							}
							any_province_lord = { character = ROOT }
						}	
					}
					AND = {
						is_land = no
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									OR = {
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT										
											}
										}
										any_province_lord = { character = ROOT }
									}	
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										OR = {
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT										
												}
											}
											any_province_lord = { character = ROOT }
										}	
									}
								}
							}
						}
					}
				}
			}
		}
		holder_scope = { 
			OR = {
				is_liege_or_above = FROM
				character = FROM 
			}	
			OR = {
				AND = {
					ROOT = { ai = yes }
					culture_group = unoccupied_group
				}
				is_nomadic = yes
			}
		}	
	}
	
	is_valid_title = {
		tier = COUNT
		location = { 
			OR = {
				has_province_flag = ruined_province
				traditional_nomad_territory_trigger = yes
			}	
			NOT = { has_province_flag = colony_province }
		}
		holder_scope = { 
			OR = {
				is_liege_or_above = FROM
				character = FROM 
			}
		}
		FROM = { 
			OR = {
				AND = {
					ROOT = { ai = yes }
					culture_group = unoccupied_group
				}
				is_nomadic = yes
			}	
		}	
	}
	
	on_add_title = {
		if = { #AI doesnt understand
			limit = { 
				ROOT = { ai = yes } 
				FROM = { culture_group = unoccupied_group }
			}
			custom_tooltip = {
				text = TOOLTIPunoccupied.3
				hidden_tooltip = {
					save_event_target_as = colonisation_target
					ROOT = { character_event = { id = unoccupied.3 } }
				}
			}
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = TOOLTIPunoccupied.3
			hidden_tooltip = {
				save_event_target_as = colonisation_target
				ROOT = { character_event = { id = unoccupied.3 } }
			}
		}			
	}

	on_success = {
		if = {
			limit = { FROM = { NOT = { culture_group = unoccupied_group } } }
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 150
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = { participation_scaled_prestige = 150 }
			}
			FROM = {
				prestige = -200
			}
		}
	}
	
	on_fail = {
		if = {
			limit = { FROM = { NOT = { culture_group = unoccupied_group } } }
			ROOT = {
				prestige = -150
			}
			FROM = {
				prestige = 100
			}
		}
		hidden_tooltip = {
			FROM = {
				any_realm_province = {
					limit = { has_province_flag = ruined_province }
					add_province_modifier = {
						name = ruined_province
						duration = -1
					}
				}
			}
		}	
	}

	on_reverse_demand = {
		if = {
			limit = { FROM = { NOT = { culture_group = unoccupied_group } } }
			ROOT = {
				prestige = -200
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
			FROM = {
				prestige = 200
			}
		}
		hidden_tooltip = {
			FROM = {
				any_realm_province = {
					limit = { has_province_flag = ruined_province }
					add_province_modifier = {
						name = ruined_province
						duration = -1
					}
				}
			}
		}
	}

	on_reverse_demand_title = {
	}

	on_attacker_leader_death = {
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0.75
		modifier = {
			factor = 0
			FROM = { culture_group = unoccupied_group }
			ROOT = { NOT = { wealth = 900 } }
		}	
		modifier = {
			factor = 0
			FROM = { NOT = { culture_group = unoccupied_group } }
			ROOT = { NOT = { wealth = 400 } }
		}		
	}
}

# Pirate Invasion
pirate_invasion = {
	name = CB_NAME_PIRATE_INVASION
	war_name = WAR_NAME_PIRATE_INVASION
	sprite = 8
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	#check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	
	allow_distant = yes # AI parameter
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		ROOT = {
			is_adult = yes
			has_regent = no
			prestige = 100
		}
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
	}

	can_use = {
		# Pirates Only
		ROOT = {
			OR = {
				government = pirate_government
				religion = lady_of_the_waves
			}	
			top_liege = {
				OR = {
					government = pirate_government
					religion = lady_of_the_waves
				}	
			}
		}
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard }			
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}		
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	can_use_title = {
		controls_religion = no
		#is_primary_holder_title = yes
		NOT = { title = d_nightswatch }	
		NOT = { title = d_kingsguard }
		# FROM = {
			# has_landed_title = PREV
		# }
	}
	
	is_valid_title = {
		# Pirates Only
		ROOT = {
			OR = {
				government = pirate_government
				religion = lady_of_the_waves
			}	
			top_liege = {
				OR = {
					government = pirate_government
					religion = lady_of_the_waves
					trait = pirate
				}	
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		hidden_tooltip = { FROM = { character_event = { id = diplomatic.3099 } } } #call for aid?
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success_title = {
		if = {
			limit = { FROM = { is_nomadic = yes } } #nomads pay tribute
			FROM = {
				custom_tooltip = {
					text = "REMOVE_PREVIOUS_SUZERAIN"
					hidden_tooltip = {
						any_suzerain = {
							FROM = {
								remove_tributary = PREV
							}
						}
					}
				}
			}
			ROOT = { make_tributary = { who = FROM percentage = 0.4 } }
			FROM = { #lose any non-nomad vassals
				any_vassal = {
					limit = {
						NOT = { is_nomadic = yes }
						NOT = { tier = BARON }
						lower_tier_than = ROOT
					}
					set_defacto_liege = ROOT
					hidden_tooltip = { character_event = { id = maintenance.25 } }#Subjugation flag maintenance
				}
			}
		}
		if = {
			limit = { FROM = { NOT = { is_nomadic = yes } } }
			ROOT = {
				vassalize_or_take_under_title = {
					title = PREV
					enemy = FROM
				}
			}
			hidden_tooltip = {
				FROM = {
					if = {
						limit = { is_liege_or_above = ROOT }
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}	
				}
			}
		}	
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { 
				add_character_modifier = { name = victory_timer duration = 3 }
				if = {
					limit = { has_ambition = obj_expand_realm }
					set_character_flag = obj_expand_realm_success
				}
			}
		}		
		ROOT = {
			hidden_tooltip = {
				character_event = { id = maintenance.24 } #Mega war flag maintenance
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		hidden_tooltip = {
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				participation_scaled_prestige = 100
			}
		}	
		FROM = {
			prestige = -100
		}
	}
	
	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			participation_scaled_prestige = 50
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = { character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } } #Take back dejure vassals (AGOT)
		any_defender = {
			participation_scaled_prestige = 100
			# if = {
				# limit = { has_character_flag = joins_the_wall }
				
			# }
		}
	}

	attacker_ai_victory_worth = {
		factor = 150
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 2
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
		modifier = { #Dont attack tributaries with strong suzerain
			factor = 0
			FROM = { 
				is_tributary = yes
				suzerain = {
					OR = {
						relative_power = { who = ROOT power = 1.5 }
						reverse_opinion = { who = ROOT value = 50 }
					}
				}
			}
		}
	}
}
anti_piracy = {
	name = "CB_NAME_ANTI_PIRACY"
	war_name = "WAR_NAME_ANTI_PIRACY"
	sprite = 1
	truce_days = 0
	hostile_against_others = yes
	can_ask_to_join_war = yes
	is_permanent = yes
	press_claim = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		FROM = {
			custom_tooltip = {
				text = TOOLTIPISHIGHLORDTIERORGREATER
				higher_tier_than = DUKE
			}
			NOT = { trait = nightswatch }
			NOT = { same_realm = ROOT }
			any_demesne_title = {
				custom_tooltip = {
					text = TOOLTIPISHIGHLORDTIERORGREATER
					higher_tier_than = DUKE
				}
				is_landless_type_title = no
				controls_religion = no
			}
		}
	}
	
	can_use = {
		ROOT = {
			NOR = {
				government = pirate_government
				religion = lady_of_the_waves
				trait = pirate
			}
			NOT = { trait = nightswatch }
		}
		FROM = {
			OR = {
				government = pirate_government
				religion = lady_of_the_waves
				trait = pirate
			}
			independent = yes
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}
	}
	
	can_use_title = {
		holder = FROM
		FROM = { primary_title = { title = PREVPREV } }
	}
	
	is_valid = {
		ROOT = {
			NOR = {
				government = pirate_government
				religion = lady_of_the_waves
				trait = pirate
			}
		}
		FROM = { 
			higher_tier_than = DUKE
			OR = {
				government = pirate_government
				religion = lady_of_the_waves
				trait = pirate
			}
		}
	}
	
	on_add = {
		hidden_tooltip = {
			ROOT = { character_event = { id = pirate.14 days = 365 random = 250 } } #leader goes pirate?
			FROM = { 
				add_character_modifier = { name = defending_pro_slavery_war days = 30 hidden = yes }
				character_event = { id = diplomatic.3099 } #call for aid? 
			}
		}
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_ANTI_PIRACY_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_ANTI_PIRACY_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_ANTI_PIRACY_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_ANTI_PIRACY_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			transfer_scaled_wealth = {
				to = ROOT
				value = 2.0
			}
		}
		ROOT = { #Take any claims
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_claim = PREV }
				}
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
				if = {
					limit = {
						higher_tier_than = BARON
						NOT = { culture = ROOT }
					}
					hidden_tooltip = { conquest_culture = ROOT }
				}
				if = {
					limit = { title = e_iron_throne } #Lose crownlands
					hidden_tooltip = { holder_scope = { character_event = { id = maintenance.37 } } }
				}
			}
		}
		FROM = {		
			custom_tooltip = {
				text = TOOLTIPanti_piracySUCCESS
				hidden_tooltip = {
					opinion = { who = ROOT modifier = forbidden_raid_target months = 120 } #forbid further raids
					remove_character_modifier = enormous_flagship
					remove_character_modifier = regular_flagship
					remove_character_modifier = small_flagship
					clr_character_flag = flagship_name_SELF
					clr_character_flag = flagship_name_FATHER
					clr_character_flag = flagship_name_SPOUSE
					clr_character_flag = flagship_name_GOD
					clr_character_flag = flagship_name_PROVINCE
					clr_character_flag = flagship_name_DYNASTY
					any_demesne_title = { 
						limit = { 
							tier = BARON
							holding_type = castle
						}
						#remove_building = ca_asoiaf_pirateshipyard_2
						remove_building = ca_asoiaf_pirateshipyard_3
						remove_building = ca_asoiaf_pirateshipyard_4
						remove_building = ca_asoiaf_pirateshipyard_5
					} 
					any_realm_lord = {
						any_demesne_title = { 
							limit = { 
								tier = BARON
								holding_type = castle
							}
							#remove_building = ca_asoiaf_pirateshipyard_2
							remove_building = ca_asoiaf_pirateshipyard_3
							remove_building = ca_asoiaf_pirateshipyard_4
							remove_building = ca_asoiaf_pirateshipyard_5
						} 
					}
					character_event = { id = raid_events.99 } #slaves and swords returned
					add_character_modifier = { #stop creation of title again
						name = defeated_pirate
						duration = 1825
						hidden = yes
					}
				}
			}
			any_demesne_title = { #Destroy higher titles
				limit = { 
					OR = {
						higher_tier_than = DUKE
						AND = { #destroy duke tier where no land is directly owned
							tier = DUKE
							NOT = {
								any_de_jure_vassal_title = {
									holder_scope = { character = ROOT_FROM }
								}
							}
						}
					}	
					controls_religion = no
					is_landless_type_title = no
					NOT = { ROOT = { has_claim = PREV } }
				}
				destroy_landed_title = yes 
			}		
			hidden_tooltip = { #lose non dejure vassals
				any_vassal = {
					limit = { NOT = { de_jure_liege_or_above = ROOT_FROM } }
					set_defacto_liege = THIS
					any_demesne_title = { 
						limit = { 
							NOT = { tier = BARON } 
							NOT = { tier = EMPEROR } 
						}
						set_variable = { which = "de_facto_empire" value = 0 } 
					}
					any_realm_lord = {
						any_demesne_title = { 
							limit = { 
								NOT = { tier = BARON } 
								NOT = { tier = EMPEROR } 
							}
							set_variable = { which = "de_facto_empire" value = 0 } 
						}
					}
				}
			}
			imprison = ROOT 
			clr_character_flag = captured_in_battle
		}		
		ROOT = {
			prestige = 250
		}
		FROM = {
			prestige = -400		
		}
	}
	
	on_fail = {
		ROOT = {
			prestige = -150
		}
		any_defender = { participation_scaled_prestige = 150 }
	}
	
	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		any_defender = { participation_scaled_prestige = 250 }
		ROOT = {
			prestige = -400
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 75
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1.5
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}
invasion_ambition = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_PIRATE_INVASION
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_title = {
		ROOT = { 
			independent = yes
			OR = {
				AND = {
					has_ambition = obj_expand_realm
					has_character_flag = may_call_ambition_invasion	
				}
				AND = {
					religion = old_ones
					has_character_flag = old_ones_invasion
				}
				has_game_rule = { name = ambition_invasion value = unrestricted }
			}	
			is_nomadic = no	
			NOT = { trait = pirate }
			NOT = { trait = wildling }
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard }
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
			NOT = { trait = nightswatch } 
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		NOT = { title = d_kingsguard } 
		OR = {
			higher_tier_than = DUKE
			AND = {
				lower_tier_than = KING
				holder_scope = { 
					independent = yes 
					tier = PREV
				}
			}
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		controls_religion = no
		OR = {
			NOT = { FROM = { capital_scope = { traditional_nomad_territory_trigger = yes } } }	
			FROM = { NOT = { is_nomadic = yes } }
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}		
	}
	
	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add = {		
		hidden_tooltip = {
			FROM = { character_event = { id = diplomatic.3099 } } #call for aid?
			ROOT = {
				if = {
					limit = {
						has_ambition = obj_expand_realm
						has_character_flag = may_call_ambition_invasion	
					}
					clr_character_flag = may_call_ambition_invasion
					set_character_flag = obj_expand_realm
				}	
				
				clr_character_flag = old_ones_invasion
			}
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		any_attacker = {
			limit = { character = ROOT }
			set_character_flag = obj_expand_realm_success
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}	
		if = {
			limit = { FROM = { is_nomadic = yes } } #nomads pay tribute
			FROM = {
				custom_tooltip = {
					text = "REMOVE_PREVIOUS_SUZERAIN"
					hidden_tooltip = {
						any_suzerain = {
							FROM = {
								remove_tributary = PREV
							}
						}
					}
				}
			}
			ROOT = { make_tributary = { who = FROM percentage = 0.4 } }
			FROM = { #lose any non-nomad vassals
				any_vassal = {
					limit = {
						NOT = { is_nomadic = yes }
						NOT = { tier = BARON }
						lower_tier_than = ROOT
					}
					set_defacto_liege = ROOT
					hidden_tooltip = { character_event = { id = maintenance.25 } }#Subjugation flag maintenance
				}
			}
		}	
		FROM = {
			prestige = -200
		}
	}

	on_success_title = {
		holder_scope = { save_event_target_as = old_usurped_title_holder }
		if = {
			limit = { FROM = { NOT = { is_nomadic = yes } } }
			hidden_tooltip = {		
				ROOT = {
					if = {
						limit = {
							NOT = {
								OR = {
									religion_group = FROM
									culture_group = FROM
								}
							}					
						}
						occupy_minors_of_occupied_settlements = FROM
						gain_all_occupied_titles = FROM	
					}	
				}
			}
			if = {
				limit = {
					ROOT = {
						NOT = {
							OR = {
								religion_group = FROM
								culture_group = FROM
							}
						}
					}	
				}	
				custom_tooltip = { text = invasion_succ_tip }	 
				hidden_tooltip = {
					if = { #Only vassalise if the target title is primary title
						limit = { 
							is_primary_holder_title = yes 
						}
						holder_scope = { set_character_flag = vassalise }
					}
					holder_scope = {
						if = {
							limit = { government = alliance_government } #disband alliance
							set_character_flag = conquest
							character_event = { id = free_cities.15 tooltip = TOOLTIPfree_cities.15 } 
						}
						PREV = { 
							usurp_title_plus_barony_if_unlanded = ROOT 
						}
						if = {
							limit = { has_character_flag = vassalise }
							clr_character_flag = vassalise
							set_defacto_liege = ROOT
						}
						
					}	
				}	
				if = {
					limit = {
						higher_tier_than = BARON
						NOT = { culture = ROOT }
					}
					hidden_tooltip = { conquest_culture = ROOT }
				}
			}	
			if = {
				limit = {
					ROOT = {
						OR = {
							religion_group = FROM
							culture_group = FROM
						}
					}	
				}
				if = {
					limit = { ROOT = { tier = EMPEROR } }	
					if = {
						limit = { FROM = { tier = EMPEROR } }
						FROM = {
							if = {
								limit = { ROOT = { tier = EMPEROR } }
								any_vassal = {
									limit = { tier = KING }
									if = {
										limit = { ROOT = { trait = civil_war } }
										set_character_flag = neutral
										custom_tooltip = { text = TOOLTIPdejure_kingdom_EMP_vassal }
										hidden_tooltip = { character_event = { id = mega_wars.52 } }
									}
									if = {
										limit = { ROOT = { NOT = { trait = civil_war } } }
										character_event = { id = mega_wars.52 tooltip = EVTTOOLTIPmega_wars.52 }
									}	
								}
							}	
							if = { 	limit = { primary_title = { title = e_north } }
									k_north = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
							}
							if = { 	limit = { primary_title = { title = e_riverlands } }
									k_riverlands  = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
							}
							if = { 	limit = { primary_title = { title = e_vale } }
									k_vale = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
							}
							if = { 	limit = { primary_title = { title = e_westerlands } }
									k_westerlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
							}
							if = { 	limit = { primary_title = { title = e_reach } }
									k_reach = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
							}
							if = { 	limit = { primary_title = { title = e_stormlands } }
									k_stormlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
							}
							if = { 	limit = { primary_title = { title = e_dorne } }
									k_dorne = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
							}
							if = { 	limit = { primary_title = { title = e_iron_isles } }
									k_iron_isles = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } } 
							}
							hidden_tooltip = { character_event = { id = maintenance.20 } } #This event takes the defeated King's title and reorganises them
						}
					}
					if = {
						limit = { FROM = { NOT = { tier = EMPEROR } } }
						FROM = { 
							set_defacto_liege = ROOT 
						}
					}	
				}
				if = {
					limit = { ROOT = { NOT = { tier = EMPEROR } } }
					if = {
						limit = { FROM = { NOT = { lower_tier_than = ROOT } } }
						FROM = { 
							if = {
								limit = { government = alliance_government } #disband alliance
								set_character_flag = conquest
								character_event = { id = free_cities.15 tooltip = TOOLTIPfree_cities.15 } 
							}
							any_demesne_title = {
								limit = { 
									tier = ROOT_FROM
									NOT = { lower_tier_than = ROOT }
									is_landless_type_title = no
								}
								usurp_title = { target = ROOT type = invasion }
							}
						}
					}
					FROM = { set_defacto_liege = ROOT }
				}	
				FROM = { #if has equivalent landless title, usurp all lower titles
					if = { 
						limit = { 					
							any_demesne_title = { 
								is_landless_type_title = yes 
								NOT = { lower_tier_than = ROOT }
							}
							NOT = { lower_tier_than = ROOT }
						}
						any_demesne_title = {
							limit = { is_landless_type_title = no }
							usurp_title = { target = ROOT type = invasion }
						}
					}	
				}	
			}
			hidden_tooltip = {			
				ROOT = { 				
					character_event = { id = maintenance.24 } #Mega war flag maintenance
					character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
				} 
				FROM = {
					if = {
						limit = { is_liege_or_above = ROOT }
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}	
				}
				FROM = { character_event = { id = diplomatic.51 days = 2 } } #destroy redundant kingdoms
			}
		}	
		clear_event_target = old_usurped_title_holder
	}
	
	on_fail = {
		ROOT = {
			prestige = -200
			set_character_flag = abort_obj
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			} 
			set_character_flag = abort_obj
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}
	
	on_invalidation = {
		ROOT = {
			if = {
				limit = { has_ambition = obj_expand_realm }
				set_character_flag = may_call_ambition_invasion
				clr_character_flag = obj_expand_realm
			}	
		}
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = whitepeace
	}

	attacker_ai_victory_worth = {
		factor = 150
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 2
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
		modifier = { #Dont waste this CB on small lords
			factor = 0
			ROOT = { higher_tier_than = DUKE }
			FROM = { NOT = { higher_tier_than = DUKE } }
		}
		modifier = {
			factor = 0
			ROOT = { tier = DUKE }
			FROM = { NOT = { higher_tier_than = COUNT } }
		}	
		modifier = { #Dont attack tributaries with strong suzerain
			factor = 0
			FROM = { 
				is_tributary = yes
				suzerain = {
					OR = {
						relative_power = { who = ROOT power = 1.5 }
						reverse_opinion = { who = ROOT value = 50 }
					}
				}
			}
		}
	}
}
plot_replace_regent_cb = {
	name = CB_NAME_REPLACE_REGENT
	war_name = WAR_NAME_REPLACE_REGENT
	sprite = 12
	truce_days = 365
	
	is_permanent = no
	can_ask_to_join_war = yes
	can_call_vassals = no
	major_revolt = no

	infamy_modifier = 0

	can_use = {
		ROOT = { 
			has_plot = plot_replace_regent
			liege = { character = FROM }
		}	
	}

	is_valid = {
		# ROOT = { 
			# has_ambition = obj_become_regent
		# }
		# FROM = { has_regent = yes }
	}
	
	on_add = {
		FROM = {
			regent = {
				event_target:chronicle_player = {
					if = {
						limit = { character = ROOT }
						chronicle = {
							entry = CHRONICLE_WAR_REGENT_ATTACKER
							portrait = [From.GetID]
						}
						break = yes
					}
					if = {
						limit = { character = FROM }
						chronicle = {
							entry = CHRONICLE_WAR_REGENT_DEFENDER
							portrait = [Root.GetID]
						}
						break = yes
					}
					if = {
						limit = { is_liege_or_above = ROOT }
						chronicle = {
							entry = CHRONICLE_WAR_REGENT_ATTACKER_LIEGE
							portrait = [Root.GetID]
						}
						break = yes
					}
					if = {
						limit = { is_liege_or_above = FROM }
						chronicle = {
							entry = CHRONICLE_WAR_REGENT_DEFENDER_LIEGE
							portrait = [From.GetID]
						}
					}
				}
			}
		}	
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			if = {
				limit = { higher_tier_than = DUKE }
				prestige = -300
			}
			if = {
				limit = { tier = DUKE }
				prestige = -150
			}
			if = {
				limit = { tier = COUNT }
				prestige = -75
			}			
			war_lost_lose_authority_effect = yes
			regent = {
				hidden_tooltip = { remove_title = title_regent }
				if = {
					limit = { has_character_flag = regent_war_target }
					if = {
						limit = { FROM = { higher_tier_than = DUKE } }
						prestige = -300
					}
					if = {
						limit = { FROM = { tier = DUKE } }
						prestige = -150
					}
					if = {
						limit = { FROM = { tier = COUNT } }
						prestige = -75
					}
					clr_character_flag = regent_war_target
					imprison = ROOT
					clr_character_flag = captured_in_battle
				}
			}
		}	
		if = {
			limit = { FROM = { has_character_flag = regent_war_mega_war } }
			FROM = { clr_character_flag = regent_war_mega_war }
			any_defender = {
				limit = { has_character_flag = regent_war_target }
				if = {
					limit = { FROM = { higher_tier_than = DUKE } }
					prestige = -300
				}
				if = {
					limit = { FROM = { tier = DUKE } }
					prestige = -150
				}
				if = {
					limit = { FROM = { tier = COUNT } }
					prestige = -75
				}
				clr_character_flag = regent_war_target
				imprison = ROOT
				clr_character_flag = captured_in_battle
			}
		}
		ROOT = {
			custom_tooltip = {
				text = TOOLTIPWINREGENCYWAR
				hidden_tooltip = { character_event = { id = regency.269 days = 1 } }
			}
		}
		if = {
			limit = { FROM = { higher_tier_than = DUKE } }
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 300
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = { participation_scaled_prestige = 300 }
			}
		}
		if = {
			limit = { FROM = { tier = DUKE } }
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 150
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = { participation_scaled_prestige = 150 }
			}
		}
		if = {
			limit = { FROM = { tier = COUNT } }
			any_attacker = {
				limit = { character = ROOT }
				participation_scaled_prestige = 75
			}
			any_attacker = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = { participation_scaled_prestige = 75 }
			}
		}
	}

	on_fail = {
		ROOT = {
			if = {
				limit = { FROM = { higher_tier_than = DUKE } }
				prestige = -150
			}
			if = {
				limit = { FROM = { tier = DUKE } }
				prestige = -75
			}
			if = {
				limit = { FROM = { tier = COUNT } }
				prestige = -35
			}
			set_character_flag = failed_regency_plot
			set_character_flag = flag_job_petition_rejected
		}
		FROM = {
			regent = {
				if = {
					limit = { has_character_flag = regent_war_target }
					clr_character_flag = regent_war_target
				}
			}
		}
		if = {
			limit = { FROM = { has_character_flag = regent_war_mega_war } }
			FROM = { 
				clr_character_flag = regent_war_mega_war 
				#regent = { hidden_tooltip = { remove_title = title_regent } }
			}
			# any_defender = {
				# limit = { has_character_flag = regent_war_target }
				# clr_character_flag = regent_war_target
				# hidden_tooltip = { set_defacto_liege = FROM }
				# if = {
					# limit = { is_councillor = no }
					# hidden_tooltip = {
						# FROM = {
							# job_castellan = { remove_title = job_castellan }			
						# }
					# }	
					# give_job_title = job_castellan			
				# }
				# give_minor_title = title_regent
			# }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			if = {
				limit = { FROM = { higher_tier_than = DUKE } }
				prestige = -300
			}
			if = {
				limit = { FROM = { tier = DUKE } }
				prestige = -150
			}
			if = {
				limit = { FROM = { tier = COUNT } }
				prestige = -75
			}
			prisoner = FROM
			set_character_flag = failed_regency_plot
			set_character_flag = flag_job_petition_rejected
		}
		FROM = {
			regent = {
				if = {
					limit = { has_character_flag = regent_war_target }
					clr_character_flag = regent_war_target
				}
			}
		}
		if = {
			limit = { FROM = { has_character_flag = regent_war_mega_war } }
			FROM = { 
				clr_character_flag = regent_war_mega_war 
				#regent = { hidden_tooltip = { remove_title = title_regent } }
			}
			# any_defender = {
				# limit = { has_character_flag = regent_war_target }
				# clr_character_flag = regent_war_target
				# hidden_tooltip = { set_defacto_liege = FROM }
				# if = {
					# limit = { is_councillor = no }
					# hidden_tooltip = {
						# FROM = {
							# job_castellan = { remove_title = job_castellan }			
						# }
					# }	
					# give_job_title = job_castellan			
				# }
				# give_minor_title = title_regent
			# }
		}
		if = {
			limit = { FROM = { higher_tier_than = DUKE } }
			any_defender = {
				limit = { character = FROM }
				participation_scaled_prestige = 200
			}
			any_defender = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { participation_scaled_prestige = 200 }
			}
		}
		if = {
			limit = { FROM = { tier = DUKE } }
			any_defender = {
				limit = { character = FROM }
				participation_scaled_prestige = 100
			}
			any_defender = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { participation_scaled_prestige = 100 }
			}
		}
		if = {
			limit = { FROM = { tier = COUNT } }
			any_defender = {
				limit = { character = FROM }
				participation_scaled_prestige = 50
			}
			any_defender = {
				limit = { NOT = { character = FROM } }
				hidden_tooltip = { participation_scaled_prestige = 50 }
			}
		}
		hidden_tooltip = {
			mega_war_emperor_rebels_resolution_effect = yes
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 90
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 75
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1	
	}
}
#Commanded by liege to bring fellow vassal to justice
enforce_justice = {
	name = CB_NAME_ENFORCE_JUSTICE
	war_name = WAR_NAME_ENFORCE_JUSTICE
	sprite = 7
	truce_days = 1095
	
	can_ask_to_join_war = yes
	is_permanent = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	allow_whitepeace = no
	
	allow_distant = yes # AI parameter

	infamy_modifier = 0
	
	can_use = {
		FROM = { 
			same_realm = ROOT
			NOT = { is_vassal_or_below = ROOT }
		} 
	}
	
	is_valid = {
		FROM = { 
			same_realm = ROOT
			NOT = { is_vassal_or_below = ROOT }
		} 			
	}
	
	on_add = {	
		# event_target:chronicle_player = {
			# if = {
				# limit = { character = ROOT }
				# chronicle = {
					# entry = CHRONICLE_WAR_VENGEANCE_ATTACKER
					# portrait = [From.GetID]
				# }
				# break = yes
			# }
			# if = {
				# limit = { character = FROM }
				# chronicle = {
					# entry = CHRONICLE_WAR_VENGEANCE_DEFENDER
					# portrait = [Root.GetID]
				# }
				# break = yes
			# }
			# if = {
				# limit = { is_liege_or_above = ROOT }
				# chronicle = {
					# entry = CHRONICLE_WAR_VENGEANCE_ATTACKER_LIEGE
					# portrait = [Root.GetID]
				# }
				# break = yes
			# }
			# if = {
				# limit = { is_liege_or_above = FROM }
				# chronicle = {
					# entry = CHRONICLE_WAR_VENGEANCE_DEFENDER_LIEGE
					# portrait = [From.GetID]
				# }
			# }
		# }
	}
	
	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
		} 
		ROOT = {
			if = {
				limit = { has_character_flag = enforce_justice_liege_1 }
				liege = { FROM = { imprison = PREV clr_character_flag = captured_in_battle } }
				clr_character_flag = enforce_justice_liege_1
			}	
			if = {
				limit = { has_character_flag = enforce_justice_liege_2 }
				liege = { liege = { FROM = { imprison = PREV clr_character_flag = captured_in_battle } } }
				clr_character_flag = enforce_justice_liege_2
			}
			if = {
				limit = { has_character_flag = enforce_justice_liege_3 }
				liege = { liege = { liege = { FROM = { imprison = PREV clr_character_flag = captured_in_battle } } } }
				clr_character_flag = enforce_justice_liege_3
			}
			save_event_target_as = enforcer
			hidden_tooltip = {
				FROM = {
					save_event_target_as = captured_vassal
					host = { letter_event = { id = 40032 } }
				}
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	# on_fail = {
		# ROOT = {
			# prestige = -50
			# transfer_scaled_wealth = {
				# to = FROM
				# value = 1.0
			# }
			# clr_character_flag = enforce_justice_liege_1
			# clr_character_flag = enforce_justice_liege_2
			# clr_character_flag = enforce_justice_liege_3
		# }
		# any_defender = {
			# limit = { character = FROM }
			# participation_scaled_prestige = 50
		# }
		# any_defender = {
			# limit = { NOT = { character = FROM } }
			# hidden_tooltip = { participation_scaled_prestige = 50 }
		# }
	# }
	
	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = { 
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			prestige = -100
			
			hidden_tooltip = {
				save_event_target_as = enforcer
				FROM = { save_event_target_as = captured_vassal }
				if = {
					limit = { has_character_flag = enforce_justice_liege_1 }
					liege = { character_event = { id = 40035 } }
					clr_character_flag = enforce_justice_liege_1
				}	
				if = {
					limit = { has_character_flag = enforce_justice_liege_2 }
					liege = { liege = { character_event = { id = 40035 } } }
					clr_character_flag = enforce_justice_liege_2
				}
				if = {
					limit = { has_character_flag = enforce_justice_liege_3 }
					liege = { liege = { liege = { character_event = { id = 40035 } } } }
					clr_character_flag = enforce_justice_liege_3
				}
			}			
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 150
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			save_event_target_as = enforcer
			FROM = { save_event_target_as = captured_vassal }
			if = {
				limit = { has_character_flag = enforce_justice_liege_1 }
				liege = { character_event = { id = 40035 } }
				clr_character_flag = enforce_justice_liege_1
			}	
			if = {
				limit = { has_character_flag = enforce_justice_liege_2 }
				liege = { liege = { character_event = { id = 40035 } } }
				clr_character_flag = enforce_justice_liege_2
			}
			if = {
				limit = { has_character_flag = enforce_justice_liege_3 }
				liege = { liege = { liege = { character_event = { id = 40035 } } } }
				clr_character_flag = enforce_justice_liege_3
			}
		}
		end_war = invalid
	}
	on_defender_leader_death = {
		ROOT = { 
			clr_character_flag = enforce_justice_liege_1
			clr_character_flag = enforce_justice_liege_2
			clr_character_flag = enforce_justice_liege_3
		}
		end_war = invalid
	}
	on_invalidation = {
		ROOT = { 
			clr_character_flag = enforce_justice_liege_1
			clr_character_flag = enforce_justice_liege_2
			clr_character_flag = enforce_justice_liege_3
		}
	}
	
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0	
	}
}
old_ones_scourge_cb = {
	name = CB_NAME_SCOURGE
	war_name = WAR_NAME_SCOURGE
	sprite = 8
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes

	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	
	can_use_gui = {
		ROOT = {
			religion = old_ones
			trait = old_ones_scourge
			NOT = { culture = FROM }
			OR = {
				trait = ambitious
				trait = ruthless
				trait = greedy
				trait = lunatic
			}
			NOT = { trait = content }
			NOT = { trait = incapable }
		}
	}

	can_use = {
		ROOT = {
			religion = old_ones
			trait = old_ones_scourge
			is_nomadic = no
			NOT = { pacifist = yes }
			NOT = { same_realm = FROM }		
			top_liege = {
				religion = ROOT
				NOT = { culture = FROM }
			}
			mercenary = no
		}
	}
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												owner = {
													OR = {
														character = ROOT
														is_liege_or_above = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			religion = old_ones
			trait = old_ones_scourge
			NOT = { pacifist = yes }
			NOT = { same_realm = FROM }
			NOT = { culture = FROM }
			top_liege = {
				NOT = { culture = FROM }
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}
	}
	
	on_add = {
		hidden_tooltip = { FROM = { character_event = { id = diplomatic.3099 } } } #call for aid?
	}
	
	on_success = {
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_piety = 100
				participation_scaled_prestige = 50
			}
		}
		
		ROOT = { 
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}
		}
		FROM = { 
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}		
		}
		FROM = { piety = -100 }
		FROM = { prestige = -50 }
	}

	on_success_title = {
		custom_tooltip = {
			text = religious_cb_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						same_religion = yes # Only vassalize rulers of my religion
						is_religious = yes
						type = holy_war
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = { 
			piety = -50 
			prestige = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			piety = -75
			prestige = -150
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_piety = 200
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { 
				participation_scaled_piety = 200
				participation_scaled_prestige = 100
			}
		}
		ROOT = { 
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}
		}
		FROM = { 
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}		
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 2
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
	}
}